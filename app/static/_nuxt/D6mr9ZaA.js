import{_ as q}from"./CrUhTerV.js";import{j as A,az as D,v as O,q as n,y as S,f as b,c as m,o as p,a as o,b as t,k as T,M as $,B as N,w as x,l as L,i as s,x as V,d as C,t as U,_ as z,m as H}from"#entry";import{_ as F}from"./CBf3hF8c.js";import{u as Y,_ as G}from"./B5arrEhJ.js";import{u as J}from"./COW2jRet.js";import"./DGycg10u.js";const K={class:"max-h-screen w-full flex overflow-hidden bg-background text-base"},Q={class:"flex-1 flex items-center justify-center"},X={class:"flex flex-col gap-10 box-border px-[10%] pb-[10%] max-w-2xl w-full"},Z={class:"mr-auto"},ee={class:"flex gap-3"},se={class:"space-y-2"},oe={key:0,class:"mt-2 text-sm text-red-500 dark:text-red-400 flex items-start gap-1"},te={class:"space-y-2"},ae={key:0,class:"mt-2 text-sm"},re={key:0,class:"flex items-center gap-2 text-green-500"},le={key:1,class:"flex items-center gap-2 text-red-500"},ne={class:"flex gap-1 justify-center"},ie={class:"flex-1"},ve=A({__name:"new-password",setup(de){const P=D(),w=O(),a=n(!1),i=n(!1),d=n(!1),_=n(P.query.userId||""),y=n(P.query.code||""),l=n(""),c=n(""),{validatePassword:I}=Y();(!_.value||!y.value)&&(console.log("[NEW PASSWORD] Missing userId or code, redirecting"),S("/forgot-password"));const f=b(()=>l.value?I(l.value):{valid:!1,errors:[],strength:"weak",percentage:0}),g=b(()=>l.value===c.value&&c.value.length>0),k=b(()=>f.value.valid&&g.value&&!a.value),M=async()=>{if(!(a.value||!k.value)){if(!f.value.valid){w.add({title:"Invalid Password",description:f.value.errors[0]||"Password does not meet requirements.",color:"error"});return}if(!g.value){w.add({title:"Passwords Do Not Match",description:"Please make sure both passwords are the same.",color:"error"});return}a.value=!0;try{console.log("[NEW PASSWORD] Resetting password for userId:",_.value);const r=await J(_.value,y.value,l.value);console.log("[NEW PASSWORD] Response:",r),w.add({title:r.messageTitle||"Password Reset!",description:r.message||"Your password has been successfully reset.",color:"success"}),await new Promise(e=>setTimeout(e,1500)),S("/login")}catch(r){console.error("[NEW PASSWORD] Error:",r);let e="An unexpected error occurred.";r.data?.error?e=r.data.error:r.message&&(e=r.message),w.add({title:"Reset Failed",description:e,color:"error"})}finally{a.value=!1}}};return(r,e)=>{const W=q,v=T,h=L,R=F,B=G,E=z,j=H;return p(),m("div",K,[o("div",Q,[o("div",X,[o("div",Z,[t(W)]),o("div",ee,[t(v,{name:"icons:logo",class:"w-12 h-12"}),e[4]||(e[4]=o("h1",{class:"text-5xl font-extrabold"},"Libris",-1))]),e[12]||(e[12]=o("div",{class:"flex flex-col gap-1"},[o("h2",{class:"text-3xl font-bold"},"Choose a new password"),o("h3",null,"Create a strong password with at least 8 characters.")],-1)),o("form",{onSubmit:$(M,["prevent"]),class:"w-100 flex flex-col gap-5"},[o("div",se,[e[6]||(e[6]=o("label",{for:"newPassword",class:"block text-sm font-medium"}," New Password ",-1)),t(R,{id:"newPassword",modelValue:s(l),"onUpdate:modelValue":e[1]||(e[1]=u=>V(l)?l.value=u:null),type:s(i)?"text":"password",placeholder:"Enter new password",class:"w-100",disabled:s(a),ui:{trailing:"pe-1"},required:""},{trailing:x(()=>[t(h,{color:"neutral",variant:"link",size:"sm",icon:s(i)?"heroicons:eye-slash":"heroicons:eye","aria-label":s(i)?"Hide password":"Show password","aria-pressed":s(i),disabled:s(a),onClick:e[0]||(e[0]=u=>i.value=!s(i))},null,8,["icon","aria-label","aria-pressed","disabled"])]),_:1},8,["modelValue","type","disabled"]),t(B,{password:s(l),"show-errors":!1},null,8,["password"]),s(l).length>=8&&!s(f).valid?(p(),m("div",oe,[t(v,{name:"heroicons:exclamation-circle-solid",class:"w-5 h-5 flex-shrink-0"}),e[5]||(e[5]=o("span",null,"One special character, number and uppercase letter needed",-1))])):N("",!0)]),o("div",te,[e[9]||(e[9]=o("label",{for:"confirmPassword",class:"block text-sm font-medium"}," Confirm Password ",-1)),t(R,{id:"confirmPassword",modelValue:s(c),"onUpdate:modelValue":e[3]||(e[3]=u=>V(c)?c.value=u:null),type:s(d)?"text":"password",placeholder:"Re-enter new password",class:"w-100",disabled:s(a),ui:{trailing:"pe-1"},required:""},{trailing:x(()=>[t(h,{color:"neutral",variant:"link",size:"sm",icon:s(d)?"heroicons:eye-slash":"heroicons:eye","aria-label":s(d)?"Hide password":"Show password","aria-pressed":s(d),disabled:s(a),onClick:e[2]||(e[2]=u=>d.value=!s(d))},null,8,["icon","aria-label","aria-pressed","disabled"])]),_:1},8,["modelValue","type","disabled"]),s(c)?(p(),m("div",ae,[s(g)?(p(),m("div",re,[t(v,{name:"heroicons:check-circle-solid",class:"w-4 h-4"}),e[7]||(e[7]=o("span",null,"Passwords match",-1))])):(p(),m("div",le,[t(v,{name:"heroicons:x-circle-solid",class:"w-4 h-4"}),e[8]||(e[8]=o("span",null,"Passwords do not match",-1))]))])):N("",!0)]),t(h,{type:"submit",class:"w-100 h-9 cursor-pointer justify-center text-lg font-bold",disabled:!s(k),loading:s(a)},{default:x(()=>[C(U(s(a)?"Resetting...":"Reset Password"),1)]),_:1},8,["disabled","loading"]),o("div",ne,[e[11]||(e[11]=o("p",{class:"text-sm"},"Remember your password?",-1)),t(E,{to:"/login",class:"text-sm text-violet-700 dark:text-violet-500 cursor-pointer hover:text-violet-800 dark:hover:text-violet-400 transition-colors"},{default:x(()=>[...e[10]||(e[10]=[C(" Back to Login ",-1)])]),_:1})])],32)])]),o("div",ie,[t(j,{src:"/images/authImage1.jpg",class:"w-full h-full object-cover",alt:"Auth image"})])])}}});export{ve as default};
