import{j as S,h as P,o as r,_ as T,w as H,a as e,t as g,b as n,k as I,q as p,ai as q,C as N,A as z,c as m,i as d,Q as A,B as O,F as j,J as B,x as V,az as F,y as E,f as M,d as D,n as J}from"#entry";import{_ as Q}from"./DduK4vxz.js";import{_ as G}from"./CoCDlcmg.js";import{_ as K}from"./BRhnR30E.js";import{u as W,a as X}from"./C6ghEBgg.js";import"./DqPfgwhY.js";import"./B4JnBqUr.js";import"./BDYeLtO0.js";import"./DNBF-Q6I.js";import"./QkSgYxCE.js";import"./DJUnOCSR.js";const Y={class:"bg-surface rounded-lg border border-base px-6 py-5 hover:shadow-md transition-shadow"},Z={class:"flex justify-between items-start"},ee={class:"flex-1"},te={class:"text-xl font-bold text-foreground mb-2"},se={class:"flex items-center gap-4 text-sm text-muted"},ne={class:"flex items-center gap-1"},oe={class:"flex items-center gap-1"},ae={class:"flex items-center gap-3"},le={class:"flex items-center gap-1"},re={class:"text-accent text-xl font-bold"},ce=S({__name:"RentalHistoryCard",props:{rental:{}},setup(s){const t=u=>{try{const[o,c,a]=u.split("-").map(Number),b=Number(c),w=Number(a),$=Number(o);return new Date($,b-1,w).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return"null"}};return(u,o)=>{const c=I,a=T;return r(),P(a,{to:{path:`/rentals/history/${s.rental.rental_id}`,query:{from:"rental"}},class:"block"},{default:H(()=>[e("div",Y,[e("div",Z,[e("div",ee,[e("h3",te,g(s.rental.title),1),e("div",se,[e("div",ne,[n(c,{name:"lucide:user",class:"w-4 h-4"}),e("span",null,"Rented from "+g(s.rental.from),1)]),e("div",oe,[n(c,{name:"lucide:calendar",class:"w-4 h-4"}),e("span",null,g(t(s.rental.rent_start_date))+" - "+g(t(s.rental.rent_end_date)),1)])])]),e("div",ae,[e("div",le,[o[0]||(o[0]=e("span",{class:"text-accent text-xl font-bold"},"-",-1)),n(c,{name:"fluent:book-coins-20-regular",class:"w-6 h-6 text-accent"}),e("span",re,g(s.rental.cost),1)])])])])]),_:1},8,["to"])}}}),ie=Object.assign(ce,{__name:"RentalHistoryCard"}),de={class:"bg-surface rounded-lg border border-base px-6 py-5 hover:shadow-md transition-shadow"},ue={class:"flex justify-between items-start"},me={class:"flex-1"},ge={class:"text-xl font-bold text-foreground mb-2"},_e={class:"flex items-center gap-4 text-sm text-muted"},fe={class:"flex items-center gap-1"},pe={class:"flex items-center gap-1"},xe={class:"flex items-center gap-3"},ve={class:"flex items-center gap-1"},he={class:"text-accent text-xl font-bold"},ye=S({__name:"LendHistoryCard",props:{lending:{}},setup(s){const t=u=>{const[o,c,a]=u.split("-").map(Number),b=Number(c),w=Number(a),$=Number(o);return new Date($,b-1,w).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})};return(u,o)=>{const c=I,a=T;return r(),P(a,{to:{path:`/rentals/history/${s.lending.rental_id}`,query:{from:"lending"}},class:"block"},{default:H(()=>[e("div",de,[e("div",ue,[e("div",me,[e("h3",ge,g(s.lending.title),1),e("div",_e,[e("div",fe,[n(c,{name:"lucide:user",class:"w-4 h-4"}),e("span",null,"Lent to "+g(s.lending.to),1)]),e("div",pe,[n(c,{name:"lucide:calendar",class:"w-4 h-4"}),e("span",null,g(t(s.lending.rent_start_date))+" - "+g(t(s.lending.rent_end_date)),1)])])]),e("div",xe,[e("div",ve,[o[0]||(o[0]=e("span",{class:"text-accent text-xl font-bold"},"+",-1)),n(c,{name:"fluent:book-coins-20-regular",class:"w-6 h-6 text-accent"}),e("span",he,g(s.lending.cost),1)])])])])]),_:1},8,["to"])}}}),be=Object.assign(ye,{__name:"LendHistoryCard"}),we="http://127.0.0.1:8080",$e=()=>{const s=p(0),t=p(!0),u=p(null),{$apiFetch:o}=q();return{completedRentalsCount:s,loading:t,error:u,fetchUserCompletedRentalsCount:async()=>{t.value=!0,u.value=null;try{const a=await o(`${we}/api/rentals/my-completed-rentals-count`,{credentials:"include"});s.value=a.count,console.log("rent counttt "+s.value)}catch(a){s.value=0,console.log("No rentals found or error fetching rental count:",a)}finally{t.value=!1}}}},Ce="http://127.0.0.1:8080",ke=()=>{const s=p(0),t=p(!0),u=p(null),{$apiFetch:o}=q();return{completedLendingsCount:s,loading:t,error:u,fetchUserCompletedLendingsCount:async()=>{t.value=!0,u.value=null;try{const a=await o(`${Ce}/api/rentals/my-completed-lendings-count`,{credentials:"include"});s.value=a.count,console.log("lend counttt "+s.value)}catch(a){s.value=0,console.log("No lendings found or error fetching lending count:",a)}finally{t.value=!1}}}},Le={class:"w-full bg-background mb-6"},Ue={key:0},Pe={key:0,class:"bg-surface rounded-lg p-6 w-full border border-base"},Re={class:"flex justify-center items-center"},Se={class:"text-center"},Ne={key:1,class:"bg-surface rounded-lg p-6 w-full border border-base"},je={class:"flex justify-center items-center"},Be={class:"text-center"},Te={class:"text-red-500 mt-4 text-lg"},He={key:2,class:"bg-surface rounded-lg p-6 w-full border border-base"},Ie={class:"flex justify-center items-center"},Oe={class:"text-center"},Ve={key:3,class:"space-y-4"},De={key:1},qe={key:0,class:"bg-surface rounded-lg p-6 w-full border border-base"},ze={class:"flex justify-center items-center"},Ae={class:"text-center"},Fe={key:1,class:"bg-surface rounded-lg p-6 w-full border border-base"},Ee={class:"flex justify-center items-center"},Me={class:"text-center"},Je={class:"text-red-500 mt-4 text-lg"},Qe={key:2,class:"bg-surface rounded-lg p-6 w-full border border-base"},Ge={class:"flex justify-center items-center"},Ke={class:"text-center"},We={key:3,class:"space-y-4"},Xe=S({__name:"RentalsHistorySection",props:{activeTab:{},sortBy:{},sortOrder:{},cardsPerPage:{}},setup(s){const t=s,{rentals:u,loading:o,error:c,fetchUserCompletedRentals:a}=W(),{completedRentalsCount:b,loading:w,fetchUserCompletedRentalsCount:$}=$e(),{lendings:h,loading:C,error:k,fetchUserCompletedLendings:L}=X(),{completedLendingsCount:U,loading:l,fetchUserCompletedLendingsCount:R}=ke(),i=p(1);return N([()=>t.sortBy,()=>t.sortOrder,()=>t.cardsPerPage,i],async x=>{t.activeTab==="renting"?(console.log("does it even reach here??"),await a(x[0],x[1],x[2],i.value)):await L(x[0],x[1],x[2],i.value)}),N(()=>t.activeTab,async x=>{i.value=1,x==="renting"?await a(t.sortBy,t.sortOrder,t.cardsPerPage,i.value):await L(t.sortBy,t.sortOrder,t.cardsPerPage,i.value)}),z(async()=>{await $(),await R(),t.activeTab==="renting"?await a(t.sortBy,t.sortOrder,t.cardsPerPage,i.value):await L(t.sortBy,t.sortOrder,t.cardsPerPage,i.value)}),(x,_)=>{const y=A,f=K;return r(),m("div",Le,[s.activeTab==="lending"?(r(),m("div",Ue,[d(C)?(r(),m("div",Pe,[e("div",Re,[e("div",Se,[n(y,{name:"lucide:loader-2",class:"w-8 h-8 text-muted mx-auto animate-spin"}),_[2]||(_[2]=e("p",{class:"text-muted mt-4 text-lg"},"Loading your past lendings...",-1))])])])):d(k)?(r(),m("div",Ne,[e("div",je,[e("div",Be,[n(y,{name:"lucide:alert-circle",class:"w-16 h-16 text-red-500 mx-auto"}),e("p",Te,g(d(k)),1)])])])):d(h).length===0?(r(),m("div",He,[e("div",Ie,[e("div",Oe,[n(y,{name:"bytesize:book",class:"w-16 h-16 text-muted mx-auto"}),_[3]||(_[3]=e("p",{class:"text-muted mt-4 text-lg"},"No past lendings yet...",-1))])])])):(r(),m("div",Ve,[(r(!0),m(j,null,B(d(h),v=>(r(),P(be,{key:v.rental_id,lending:v},null,8,["lending"]))),128)),d(l)?O("",!0):(r(),P(f,{key:0,page:d(i),"onUpdate:page":_[0]||(_[0]=v=>V(i)?i.value=v:null),"items-per-page":s.cardsPerPage,total:d(U),class:"w-full flex justify-center"},null,8,["page","items-per-page","total"]))]))])):(r(),m("div",De,[d(o)?(r(),m("div",qe,[e("div",ze,[e("div",Ae,[n(y,{name:"lucide:loader-2",class:"w-8 h-8 text-muted mx-auto animate-spin"}),_[4]||(_[4]=e("p",{class:"text-muted mt-4 text-lg"},"Loading your past rentals...",-1))])])])):d(c)?(r(),m("div",Fe,[e("div",Ee,[e("div",Me,[n(y,{name:"lucide:alert-circle",class:"w-16 h-16 text-red-500 mx-auto"}),e("p",Je,g(d(c)),1)])])])):d(u).length===0?(r(),m("div",Qe,[e("div",Ge,[e("div",Ke,[n(y,{name:"bytesize:book",class:"w-16 h-16 text-muted mx-auto"}),_[5]||(_[5]=e("p",{class:"text-muted mt-4 text-lg"},"No past rentals yet...",-1))])])])):(r(),m("div",We,[(r(!0),m(j,null,B(d(u),v=>(r(),P(ie,{key:v.rental_id,rental:v},null,8,["rental"]))),128)),d(w)?O("",!0):(r(),P(f,{key:0,page:d(i),"onUpdate:page":_[1]||(_[1]=v=>V(i)?i.value=v:null),"items-per-page":s.cardsPerPage,total:d(b),class:"w-full flex justify-center"},null,8,["page","items-per-page","total"]))]))]))])}}}),Ye=Object.assign(Xe,{__name:"RentalsHistorySection"}),Ze={class:"flex flex-col h-auto w-full pt-4 px-4 md:px-8 lg:px-15"},et={class:"mb-6 flex justify-between items-start px-10 pt-5"},tt={class:"text-base"},st={class:"font-bold text-3xl flex items-center gap-2 mb-1"},nt={class:"w-full bg-background"},ot={class:"mx-auto"},at={class:"grid grid-cols-2 gap-3 mb-6"},lt=["onClick"],rt={class:"flex items-center justify-center gap-1"},ct={class:"text-sm leading-tight"},it={class:"flex mb-6"},dt={class:"flex-1 text-xl font-bold text-foreground"},ut={class:"flex-[3] flex justify-center gap-2"},mt={class:"flex items-center gap-2"},gt={class:"flex items-center gap-2"},_t={class:"flex items-center gap-2"},ft={class:"flex-1 flex justify-end items-center"},Ut=S({__name:"index",setup(s){const t=p("lending"),o=F().query.activeTab;o&&!Array.isArray(o)&&(o==="lending"||o==="renting")&&(t.value=o),E({query:{activeTab:t.value}},{replace:!0});const c=[{id:"lending",label:"Books I've Lent",icon:"lucide:trending-up"},{id:"renting",label:"Books I've Rented",icon:"lucide:trending-down"}],a=M(()=>t.value==="lending"?"Lend History":"Rent History"),b=p(["Start date","End date"]),w=p(["newest first","oldest first"]),$=p([10,25,50]),h=p("Start date"),C=p("newest first"),k=p(10),L=U=>{const l=new URL(window.location.href);l.searchParams.set("activeTab",U),window.history.replaceState({},"",l.toString())};return L(t.value),N(t,U=>{L(U)}),(U,l)=>{const R=I,i=Q,x=G,_=T,y=Ye;return r(),m("div",Ze,[e("div",et,[e("div",tt,[e("h1",st,[n(R,{name:"fluent:calendar-24-regular",class:"w-8 h-8 text-orange-500"}),l[3]||(l[3]=D(" My Rental History ",-1))]),l[4]||(l[4]=e("p",{class:"text-muted"},"See your lending and renting activity",-1))])]),e("div",nt,[e("div",ot,[e("div",at,[(r(),m(j,null,B(c,f=>e("button",{key:f.id,class:J(["px-4 py-3 rounded-lg font-medium transition-all text-center cursor-pointer",t.value===f.id?"bg-accent text-white":"bg-surface text-foreground hover:bg-surface-hover"]),onClick:v=>t.value=f.id},[e("div",rt,[n(R,{name:f.icon},null,8,["name"]),e("span",ct,g(f.label),1)])],10,lt)),64))])])]),e("div",it,[e("h2",dt,g(a.value),1),e("div",ut,[e("div",mt,[l[5]||(l[5]=e("p",null,"Sort by",-1)),n(i,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=f=>h.value=f),items:b.value,class:"w-45"},null,8,["modelValue","items"])]),n(x,{orientation:"vertical",color:"primary",size:"sm"}),e("div",gt,[l[6]||(l[6]=e("p",null,"Show",-1)),n(i,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=f=>C.value=f),items:w.value,class:"w-45"},null,8,["modelValue","items"])]),n(x,{orientation:"vertical",color:"primary",size:"sm"}),e("div",_t,[n(i,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=f=>k.value=f),items:$.value,class:"w-20"},null,8,["modelValue","items"]),l[7]||(l[7]=e("p",null,"cards per page",-1))])]),e("div",ft,[n(_,{to:{path:"/rentals",query:{activeTab:t.value}},class:"text-foreground font-medium flex gap-1 cursor-pointer"},{default:H(()=>[D(" Current "+g(t.value==="lending"?"lendings":"rentals")+" ",1),n(R,{name:"lucide:move-right",class:"w-6 h-6 text-foreground"})]),_:1},8,["to"])])]),n(y,{"sort-by":h.value,"sort-order":C.value,"cards-per-page":k.value,"active-tab":t.value},null,8,["sort-by","sort-order","cards-per-page","active-tab"])])}}});export{Ut as default};
