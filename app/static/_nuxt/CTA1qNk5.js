import{e as j,b1 as V,D as E,f as _,c as d,o as l,_ as R,q as r,w as y,a as o,l as q,b as i,t as w,s as x,d as U,g as z,aN as A,m as v,v as F,p as M,aP as I,aQ as O,ae as W,G,H as T,aO as H,P as Q}from"#entry";import{_ as J,e as K,d as X}from"./njzFu03f.js";import{e as Y}from"./Di3rZokN.js";const Z={class:"flex-[2] w-full rounded-t-xl overflow-hidden"},ee={class:"flex-1 flex flex-col gap-[10px] px-5 py-4 bg-surface-hover w-full rounded-b-xl"},te={class:"flex-1 flex flex-col gap-1 items-center pb-1"},oe={class:"text-lg text-center font-semibold text-base truncate w-full"},se={class:"text-left text-xs text-base truncate"},ae={class:"text-left text-xs text-base truncate w-full"},le={class:"flex gap-2 items-start"},ne={class:"flex flex-col gap-1"},ie={key:0,class:"flex gap-2 items-center"},ce={class:"flex-1 flex gap-1 items-center"},re={class:"flex items-center"},ue={class:"text-xs text-primary font-semibold"},de={key:1,class:"flex gap-2 items-center"},fe={class:"flex-1 flex gap-1 items-center"},pe={class:"flex items-center"},me={class:"text-xs text-primary font-semibold"},be={key:2,class:"flex gap-2 items-center h-5"},_e={key:1,class:"w-full h-[400px] flex flex-col items-center justify-center bg-transparent"},xe=j({__name:"BookListCard",props:{cardType:{},bookDetails:{}},setup(f){const e=f,p=V(),B=E(()=>{let c="browse",t=`from=${c}`;if(p.path.includes("/collection")){c="user-collection";const u=p.params.id;t=`from=${c}&collectionOwnerId=${u}`}return`/books/${e.bookDetails?.bookId}?${t}`});return(c,t)=>{const u=q,k=J,n=K,g=X,h=z,D=R;return e.cardType==="hasContent"?(l(),_(D,{key:0,to:r(B),class:"w-full h-[400px] flex flex-col items-center justify-center transition-transform duration-300 hover:scale-103 cursor-pointer"},{default:y(()=>[o("div",Z,[e.bookDetails?.firstImageUrl?(l(),_(u,{key:0,src:e.bookDetails?.firstImageUrl,class:"w-full h-full object-cover",alt:"Auth image"},null,8,["src"])):(l(),_(u,{key:1,src:"/images/noImageImage.jpg",class:"w-full h-full object-cover",alt:"Auth image"}))]),o("div",ee,[o("div",te,[i(k,{text:e.bookDetails?.title},{default:y(()=>[o("p",oe,w(e.bookDetails?.title),1)]),_:1},8,["text"]),i(k,{text:e.bookDetails?.author,class:"flex-[3]"},{default:y(()=>[o("p",se,"by "+w(e.bookDetails?.author),1)]),_:1},8,["text"]),i(n,{color:"primary",type:"solid",class:"flex-1"}),i(k,{text:e.bookDetails?.ownerUsername,class:"flex-[3]"},{default:y(()=>[o("p",ae," Owned by: "+w(e.bookDetails?.ownerUsername),1)]),_:1},8,["text"])]),o("div",le,[["rent","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(l(),_(g,{key:0,class:"font-bold rounded-full"},{default:y(()=>[...t[0]||(t[0]=[U("For Rent",-1)])]),_:1})):x("",!0),["purchase","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(l(),_(g,{key:1,color:"error",class:"font-bold rounded-full"},{default:y(()=>[...t[1]||(t[1]=[U("For Sale",-1)])]),_:1})):x("",!0)]),o("div",ne,[["rent","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(l(),d("div",ie,[o("div",ce,[i(h,{name:"solar:clock-circle-bold",class:"w-5 h-5 text-base"}),t[2]||(t[2]=o("p",{class:"flex-1 text-sm font-semibold text-base"},"Rent",-1))]),o("div",re,[i(h,{name:"fluent:book-coins-20-regular",class:"w-5 h-5 text-accent"}),o("p",ue,w(e.bookDetails?.dailyRentPrice)+"/day ",1)])])):x("",!0),["purchase","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(l(),d("div",de,[o("div",fe,[i(h,{name:"solar:cart-large-2-bold-duotone",class:"w-5 h-5 text-base"}),t[3]||(t[3]=o("p",{class:"flex-1 text-sm font-semibold text-base"},"Buy",-1))]),o("div",pe,[i(h,{name:"fluent:book-coins-20-regular",class:"w-5 h-5 text-accent"}),o("p",me,w(e.bookDetails?.purchasePrice),1)])])):x("",!0),["rent","purchase"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(l(),d("div",be)):x("",!0)])])]),_:1},8,["to"])):(l(),d("div",_e))}}}),ke=Object.assign(xe,{__name:"BookListCard"});function he(f){const{$apiFetch:e}=A();return e("/api/books/book-list-books",{method:"GET",credentials:"include",query:{...f||{}}})}function ye(f){const{$apiFetch:e}=A();return e("/api/books/book-list-books-count",{method:"GET",credentials:"include",query:{...f||{}}})}const ve={class:"h-full w-full flex flex-col items-center"},ge={class:"flex-1 pt-5 w-full relative"},we={key:0,class:"absolute inset-0 flex justify-center items-center bg-background z-5"},Be={key:1,class:"absolute inset-0 flex justify-center items-center bg-background z-5"},De=225,$e=j({__name:"BookList",props:{headerState:{},userId:{}},setup(f){const e=f,p=v([]),B=v(null),c=v(1),t=v(1),u=v(0),k=()=>{const s=B.value;if(!s)return 0;const a=s.clientWidth,m=12;return Math.max(1,Math.floor((a+m)/(De+m)))*2},n=v(!1),g=async()=>{const s=k();if(s<=0)return;c.value=s;const a={booksPerPage:c.value,pageNumber:t.value,searchValue:e.headerState.searchValue,bookGenre:e.headerState.selectedBookGenre,bookAvailability:e.headerState.selectedBookAvailability,userId:e.userId},m=await he(a);p.value=m},h=async()=>{const s={searchValue:e.headerState.searchValue,bookGenre:e.headerState.selectedBookGenre,bookAvailability:e.headerState.selectedBookAvailability,userId:e.userId},{totalCount:a}=await ye(s);u.value=a},D=()=>{const s=Math.ceil(u.value/c.value)||1;t.value>s&&(t.value=s),u.value===0&&(t.value=1)},$=I(async()=>{await g()},700),L=I(async()=>{await h(),D()},700);let P=0;const S=I(async()=>{await Q(),await new Promise(a=>requestAnimationFrame(a)),await new Promise(a=>setTimeout(a,80));const s=k();if(!(s===P||s<=0)){P=s,n.value=!0;try{await g(),D()}finally{n.value=!1}}},400);return F(()=>t.value,async()=>{n.value=!0;try{await $()}finally{n.value=!1}}),F([()=>e.headerState.searchValue,()=>e.headerState.selectedBookAvailability,()=>e.headerState.selectedBookGenre],async()=>{n.value=!0;try{await $(),await L()}catch(s){console.error("Error loading books:",s)}finally{n.value=!1}},{deep:!0}),M(async()=>{n.value=!0,await $(),await L(),n.value=!1,window.addEventListener("resize",S)}),O(()=>{window.removeEventListener("resize",S)}),(s,a)=>{const m=W,C=ke,N=Y;return l(),d("div",ve,[o("div",ge,[r(n)?(l(),d("div",we,[i(m,{name:"i-heroicons-arrow-path",class:"w-8 h-8 animate-spin text-accent"}),a[1]||(a[1]=o("span",{class:"ml-2 text-muted"},"Loading books...",-1))])):x("",!0),!r(n)&&r(p).length==0?(l(),d("div",Be,[i(m,{name:"heroicons:x-mark-16-solid",class:"w-12 h-12 animate-bounce text-accent"}),a[2]||(a[2]=o("span",{class:"ml-2 text-muted"},"No books here...",-1))])):x("",!0),o("div",{ref_key:"gridContainer",ref:B,class:"grid grid-cols-[repeat(auto-fit,minmax(225px,1fr))] gap-3",style:{"grid-auto-rows":"400px","max-height":"calc(400px * 2 + 12px)","min-height":"calc(400px * 2 + 12px)",overflow:"hidden"}},[(l(!0),d(G,null,T(r(p),b=>(l(),_(C,{key:b.bookId,"card-type":"hasContent","book-details":b},null,8,["book-details"]))),128)),(l(!0),d(G,null,T(Math.max(0,r(c)-r(p).length),b=>(l(),_(C,{key:b,"card-type":"empty"}))),128))],512)]),i(N,{page:r(t),"onUpdate:page":a[0]||(a[0]=b=>H(t)?t.value=b:null),"items-per-page":r(c),"show-edges":"","sibling-count":0,total:r(u),class:"py-5"},null,8,["page","items-per-page","total"])])}}}),Pe=Object.assign($e,{__name:"BookList"});export{Pe as _};
