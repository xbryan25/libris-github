import{v as N,_ as O}from"./DX4MsDF4.js";import{j as $,q as _,s as M,v as h,f as V,h as T,o as I,w as g,a as d,b as u,i as o,x as L,l as j,d as S,c as B,m as C,y as x}from"#entry";import{_ as k}from"./CBf3hF8c.js";import{_ as G,a as F}from"./CJgwwgom.js";import{_ as E}from"./BdGgjiO2.js";import{u as P}from"./Bf-nPiyi.js";import"./CrUhTerV.js";import"./CoCDlcmg.js";import"./DJUnOCSR.js";import"./B5arrEhJ.js";import"./DGycg10u.js";import"./xkkEXfMU.js";import"./CxmxAOEW.js";import"./QkSgYxCE.js";import"./DNBF-Q6I.js";const R=async(U,a)=>$fetch("http://127.0.0.1:8080/api/users/new-username",{method:"POST",credentials:"include",body:{userId:U,username:a}}),z={class:"flex flex-col gap-5"},q={class:"flex justify-end gap-2 w-full"},D=$({__name:"AddUsernameModal",props:{userId:{},isOpenAddUsernameModal:{type:Boolean}},emits:["update:openAddUsernameModal","addUsernameSuccess"],setup(U,{emit:a}){const r=U,l=a,t=_(""),n=_(!1),v=M(),y=h(),c=V({get:()=>r.isOpenAddUsernameModal,set:s=>{l("update:openAddUsernameModal",s)}}),w=async()=>{try{n.value=!0;const{messageTitle:s,message:e}=await R(r.userId,t.value);y.add({title:s,description:e,color:"success"}),v.username=t.value,l("addUsernameSuccess")}catch(s){y.add({title:"Username update failed.",description:s.data.error,color:"error"}),n.value=!1}};return(s,e)=>{const m=k,b=F,p=j,i=G,A=E;return I(),T(A,{open:o(c),"onUpdate:open":e[3]||(e[3]=f=>L(c)?c.value=f:null)},{header:g(()=>[...e[4]||(e[4]=[d("h2",{class:"text-3xl font-semibold"},"Add Username",-1)])]),body:g(()=>[d("div",z,[e[7]||(e[7]=d("div",{class:"flex gap-1"},[d("p",{class:"text-sm"},"Note:"),d("p",{class:"text-sm"}," Your account has been created, but you need to provide your username to continue. ")],-1)),u(i,{validate:f=>o(N)(f,o(c)),state:o(t),class:"space-y-4",onSubmit:e[2]||(e[2]=async()=>await w())},{default:g(()=>[u(b,{label:"Username",name:"username"},{default:g(()=>[u(m,{modelValue:o(t),"onUpdate:modelValue":e[0]||(e[0]=f=>L(t)?t.value=f:null),class:"w-full",disabled:o(n)},null,8,["modelValue","disabled"])]),_:1}),d("div",q,[u(p,{size:"md",color:"error",variant:"solid",class:"cursor-pointer",onClick:e[1]||(e[1]=f=>c.value=!1)},{default:g(()=>[...e[5]||(e[5]=[S("Cancel",-1)])]),_:1}),u(p,{size:"md",color:"primary",variant:"solid",class:"cursor-pointer",type:"submit",disabled:o(n),loading:o(n)},{default:g(()=>[...e[6]||(e[6]=[S("Add Username",-1)])]),_:1},8,["disabled","loading"])])]),_:1},8,["validate","state"])])]),_:1},8,["open"])}}}),H=Object.assign(D,{__name:"AddUsernameModal"}),Y={class:"h-screen w-full flex overflow-hidden bg-background text-base"},J={class:"flex-1 flex items-center justify-center"},K={class:"flex-1"},ce=$({__name:"login",setup(U){const a=h(),r=M(),l=_(!1),t=_(!1),n=_(!1),v=_(!1),y=async(s,e)=>{l.value=!0,t.value=!0;try{const{messageTitle:m,message:b,isEmailVerified:p}=await r.login(s,e);if(p)a.add({title:m,description:b,color:"success"}),x("/dashboard");else{const i=r.userId;if(!i){console.error("No userId in response!");return}await P(i),a.add({title:"Login successful",description:"However, to continue to Libris, please verify your email.",color:"success"}),x(`/verify-email?userId=${i}`)}}catch(m){a.add({title:"Login failed.",description:m.data.error,color:"error"}),l.value=!1,t.value=!1}},c=async()=>{try{l.value=!0,n.value=!0;const{messageTitle:s,message:e}=await r.googleLogin();r.username===null?v.value=!0:(a.add({title:s,description:e,color:"success"}),x("/dashboard"))}catch(s){console.log(s),console.log(s.type),s?.type==="popup_closed"||a.add({title:"Login via Google failed.",description:s?.data?.error,color:"error"}),l.value=!1,n.value=!1}},w=async()=>{try{x("/dashboard")}catch(s){a.add({title:"Login via Google failed.",description:s.data.error,color:"error"})}};return(s,e)=>{const m=O,b=C,p=H;return I(),B("div",Y,[d("div",J,[u(m,{"auth-type":"login","is-disabled":o(l),"is-loading":o(t),"is-loading-google":o(n),onOnSubmitLogin:e[0]||(e[0]=(i,A)=>y(i,A)),onOnSubmitGoogleLogin:e[1]||(e[1]=async()=>await c())},null,8,["is-disabled","is-loading","is-loading-google"])]),d("div",K,[u(b,{src:"/images/authImage1.jpg",class:"w-full h-full object-cover",alt:"Auth image"})]),u(p,{"user-id":o(r).userId,"is-open-add-username-modal":o(v),"onUpdate:openAddUsernameModal":e[2]||(e[2]=i=>{v.value=i,l.value=!1,n.value=!1}),onAddUsernameSuccess:w},null,8,["user-id","is-open-add-username-modal"])])}}});export{ce as default};
