import{j as q,c as v,o as r,b as u,f as I,a as t,k as U,t as R,d as j,i as e,q as P,ai as oe,v as G,F as W,B as y,h as $,D,G as H,C as E,w as S,l as K,z as Z,aB as ee,n as F,aC as te,J as ne,x as N,y as J,az as le,aA as ae,A as ie}from"#entry";import{_ as ce,a as de,b as ue}from"./C_bF1xQj.js";import{_ as me}from"./JAi2wY28.js";import{_ as Q}from"./BdGgjiO2.js";import{u as se,a as X}from"./C6ghEBgg.js";import{u as pe}from"./DYDtN5Cg.js";import"./BYnHXhte.js";import"./QkSgYxCE.js";import"./DJUnOCSR.js";import"./kRIii9yh.js";import"./CxmxAOEW.js";import"./DNBF-Q6I.js";const fe={class:"bg-surface rounded-lg border border-base p-6"},be=q({__name:"RentalProgressStepper",props:{status:{},from:{}},setup(l){const h=l,a=()=>h.from==="rental"?[{title:"Requested",description:"Rental request sent",icon:"i-lucide-send"},{title:"Confirmed",description:"Owner approved request",icon:"i-lucide-check-circle"},{title:"Pickup",description:"Ready for pickup",icon:"i-lucide-package"},{title:"Renting",description:"Currently renting",icon:"i-lucide-book-open"},{title:"Return",description:"Ready for return",icon:"i-lucide-package-check"},{title:"Completed",description:"Rental finished",icon:"i-lucide-circle-check"},{title:"Rate",description:"Rate the experience",icon:"i-lucide-star"}]:[{title:"Pending",description:"Rental request received",icon:"i-lucide-send"},{title:"Confirmed",description:"Approved request",icon:"i-lucide-check-circle"},{title:"Delivered",description:"Book Delivered",icon:"i-lucide-package"},{title:"Active",description:"Currently lending",icon:"i-lucide-book-open"},{title:"Pickup",description:"Ready for return pickup",icon:"i-lucide-package-check"},{title:"Completed",description:"Rental finished",icon:"i-lucide-circle-check"},{title:"Rate",description:"Rate the experience",icon:"i-lucide-star"}],c=()=>({pending:0,approved:1,awaiting_pickup_confirmation:2,ongoing:3,awaiting_return_confirmation:4,completed:5,rate_user:6})[h.status]??0;return(p,w)=>{const d=me;return r(),v("div",fe,[u(d,{disabled:"",items:a(),"model-value":c()},null,8,["items","model-value"])])}}}),ge=Object.assign(be,{__name:"RentalProgressStepper"}),_e={class:"bg-purple-50 border border-purple-200 rounded-lg p-5"},he={class:"flex items-start gap-3"},xe={class:"flex-1"},ve={class:"text-purple-900 font-medium mb-2"},ke={class:"text-sm text-purple-800"},ye=q({__name:"RentalActiveAlert",props:{from:{},rentEndDate:{}},setup(l){const h=l,a=I(()=>{if(!h.rentEndDate)return 0;const c=new Date(h.rentEndDate),p=new Date,w=c.getTime()-p.getTime(),d=Math.ceil(w/(1e3*60*60*24));return d>0?d:0});return(c,p)=>{const w=U;return r(),v("div",_e,[t("div",he,[u(w,{name:"lucide:book-open",class:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),t("div",xe,[t("p",ve,R(l.from==="rental"?"You are currently renting this book.":"This book is currently being rented."),1),t("p",ke,[t("strong",null,R(e(a)),1),p[0]||(p[0]=j(" day(s) remaining until return date. ",-1))])])])])}}}),we=Object.assign(ye,{__name:"RentalActiveAlert"}),V="http://127.0.0.1:8080",Y=()=>{const l=P(!1),h=P(null),{$apiFetch:a}=oe();return{loading:l,error:h,approveRental:async(o,n)=>{l.value=!0,h.value=null;try{const s=await a(`${V}/api/rentals/${o}/approve`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({meetupTime:n})});return{success:!0}}catch(s){console.error("Error approving rental:",s);let i="Failed to approve rental";return s?.error?i=s.error:s?.message?i=s.message:typeof s=="string"&&(i=s),h.value=i,{success:!1,error:i}}finally{l.value=!1}},rejectRental:async(o,n)=>{l.value=!0,h.value=null,console.log("Rejecting rental:",{rentalId:o,reason:n}),console.log("API URL:",`${V}/api/rentals/${o}/reject`);try{const s=await a(`${V}/api/rentals/${o}/reject`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:n})});return console.log("Rejection response:",s),{success:!0}}catch(s){console.error("Error rejecting rental:",s),console.error("Error details:",{data:s.data,status:s.status,statusText:s.statusText,message:s.message});let i="Failed to reject rental";return s?.error?i=s.error:s?.message?i=s.message:typeof s=="string"&&(i=s),h.value=i,{success:!1,error:i}}finally{l.value=!1}},cancelRental:async o=>{l.value=!0,h.value=null,console.log("Cancelling rental:",{rentalId:o}),console.log("API URL:",`${V}/api/rentals/${o}/cancel`);try{const n=await a(`${V}/api/rentals/${o}/cancel`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});return console.log("Cancel response:",n),{success:!0}}catch(n){console.error("Error cancelling rental:",n),console.error("Error details:",{data:n.data,status:n.status,statusText:n.statusText,message:n.message});let s="Failed to cancel rental";return n?.error?s=n.error:n?.message?s=n.message:typeof n=="string"&&(s=n),h.value=s,{success:!1,error:s}}finally{l.value=!1}},confirmPickup:async o=>{l.value=!0,h.value=null,console.log("Confirming pickup:",{rentalId:o});try{const n=await a(`${V}/api/rentals/${o}/confirm-pickup`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});return console.log("Confirm pickup response:",n),{success:!0,data:n}}catch(n){console.error("Error confirming pickup:",n);let s="Failed to confirm pickup";return n?.error?s=n.error:n?.message?s=n.message:typeof n=="string"&&(s=n),h.value=s,{success:!1,error:s}}finally{l.value=!1}},confirmReturn:async o=>{l.value=!0,h.value=null,console.log("Confirming return:",{rentalId:o});try{const n=await a(`${V}/api/rentals/${o}/confirm-return`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});return console.log("Confirm return response:",n),{success:!0,data:n}}catch(n){console.error("Error confirming return:",n);let s="Failed to confirm return";return n?.error?s=n.error:n?.message?s=n.message:typeof n=="string"&&(s=n),h.value=s,{success:!1,error:s}}finally{l.value=!1}}}},Re={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-5"},$e={class:"flex items-start gap-3"},Ce={key:1,class:"bg-blue-50 border-2 border-blue-300 rounded-lg p-5"},je={class:"mb-4 flex items-start gap-3"},Te={class:"text-sm text-blue-900 font-medium"},Se={key:0,class:"mb-4 bg-green-50 border border-green-200 rounded-lg p-4"},Pe={class:"flex items-center gap-2"},Me=["disabled"],Ae={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-5"},Ie={class:"flex items-start gap-3"},Be={key:3,class:"bg-blue-50 border-2 border-blue-300 rounded-lg p-5"},qe={class:"mb-4 flex items-start gap-3"},Ue={class:"text-sm text-blue-900 font-medium"},Oe={key:0,class:"mb-4 bg-green-50 border border-green-200 rounded-lg p-4"},Ve={class:"flex items-center gap-2"},De=["disabled"],Ee=q({__name:"RentalConfirmationCard",props:{status:{},from:{},meetupDate:{},meetupTime:{},rentEndDate:{},rentalId:{},userConfirmedPickup:{type:Boolean},ownerConfirmedPickup:{type:Boolean},userConfirmedReturn:{type:Boolean},ownerConfirmedReturn:{type:Boolean}},emits:["refresh"],setup(l,{emit:h}){const a=l,c=h,{confirmPickup:p,confirmReturn:w,loading:d}=Y(),g=G(),o=I(()=>a.status==="awaiting_pickup_confirmation"),n=I(()=>a.status==="awaiting_return_confirmation"),s=I(()=>a.from==="rental"?a.userConfirmedPickup:a.ownerConfirmedPickup),i=I(()=>a.from==="rental"?a.userConfirmedReturn:a.ownerConfirmedReturn),T=async()=>{const b=await p(a.rentalId);b.success?(g.add({title:"Success",description:"Pickup confirmed!",icon:"i-lucide-check-circle"}),c("refresh")):g.add({title:"Error",description:b.error||"Failed to confirm pickup",icon:"i-lucide-alert-circle",color:"red"})},_=async()=>{const b=await w(a.rentalId);b.success?(g.add({title:"Success",description:"Return confirmed!",icon:"i-lucide-check-circle"}),c("refresh")):g.add({title:"Error",description:b.error||"Failed to confirm return",icon:"i-lucide-alert-circle",color:"red"})};return(b,m)=>{const k=U;return r(),v(W,null,[l.status==="approved"?(r(),v("div",Re,[t("div",$e,[u(k,{name:"lucide:clock",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),m[0]||(m[0]=t("p",{class:"text-sm text-blue-900"}," A confirmation button will appear 1 hour before the meetup time to confirm the book handoff. ",-1))])])):y("",!0),e(o)?(r(),v("div",Ce,[t("div",je,[u(k,{name:"lucide:alert-circle",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),t("p",Te," Please confirm if you have "+R(l.from==="rental"?"received":"delivered")+" the book. Both users must confirm to progress the rental. ",1)]),e(s)?(r(),v("div",Se,[t("div",Pe,[u(k,{name:"lucide:check-circle",class:"w-5 h-5 text-green-600"}),m[1]||(m[1]=t("p",{class:"text-sm font-medium text-green-900"}," ✓ Confirmed. Waiting for other user to confirm... ",-1))])])):y("",!0),e(s)?y("",!0):(r(),v("button",{key:1,onClick:T,disabled:e(d),class:"w-full bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white px-4 py-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 cursor-pointer disabled:cursor-not-allowed"},[e(d)?(r(),$(k,{key:1,name:"lucide:loader-2",class:"w-5 h-5 animate-spin"})):(r(),$(k,{key:0,name:"lucide:check",class:"w-5 h-5"})),j(" "+R(e(d)?"Confirming...":l.from==="rental"?"Confirm Received Book":"Confirm Delivered Book"),1)],8,Me))])):y("",!0),l.status==="ongoing"?(r(),v("div",Ae,[t("div",Ie,[u(k,{name:"lucide:clock",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),m[2]||(m[2]=t("p",{class:"text-sm text-blue-900"}," A confirmation button will appear 1 hour before the return date to confirm the book return. ",-1))])])):y("",!0),e(n)?(r(),v("div",Be,[t("div",qe,[u(k,{name:"lucide:alert-circle",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),t("p",Ue," Please confirm if you have "+R(l.from==="rental"?"returned":"received back")+" the book. Both users must confirm to complete the rental. ",1)]),e(i)?(r(),v("div",Oe,[t("div",Ve,[u(k,{name:"lucide:check-circle",class:"w-5 h-5 text-green-600"}),m[3]||(m[3]=t("p",{class:"text-sm font-medium text-green-900"}," ✓ Confirmed. Waiting for other user to confirm... ",-1))])])):y("",!0),e(i)?y("",!0):(r(),v("button",{key:1,onClick:_,disabled:e(d),class:"w-full bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white px-4 py-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2 cursor-pointer disabled:cursor-not-allowed"},[e(d)?(r(),$(k,{key:1,name:"lucide:loader-2",class:"w-5 h-5 animate-spin"})):(r(),$(k,{key:0,name:"lucide:check",class:"w-5 h-5"})),j(" "+R(e(d)?"Confirming...":l.from==="rental"?"Confirm Returned Book":"Confirm Received Back Book"),1)],8,De))])):y("",!0)],64)}}}),Fe=Object.assign(Ee,{__name:"RentalConfirmationCard"}),Le={class:"space-y-4"},Ne={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3 dark:bg-red-900/20 dark:border-red-800"},We={class:"flex items-start gap-2"},Ye={class:"text-sm text-red-900 dark:text-red-300"},ze={class:"bg-blue-50 border border-blue-200 rounded-lg p-3 dark:bg-blue-900/20 dark:border-blue-800"},Je={class:"flex items-start gap-2"},Ge={class:"w-full flex justify-end gap-3"},He=q({__name:"RentalCancelModal",props:D({rentalId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:D(["success"],["update:modelValue"]),setup(l,{emit:h}){const a=l,c=H(l,"modelValue"),p=h,{fetchUserRentals:w}=se(),{cancelRental:d,loading:g}=Y(),o=P(""),n=async()=>{o.value="";const s=await d(a.rentalId);s.success?(p("success"),c.value=!1,await w()):o.value=s.error||"Failed to cancel rental"};return E(c,s=>{s||(o.value="")}),(s,i)=>{const T=U,_=K,b=Q;return r(),$(b,{open:c.value,"onUpdate:open":i[1]||(i[1]=m=>c.value=m)},{header:S(()=>[...i[2]||(i[2]=[t("h2",{class:"text-2xl font-semibold"},"Cancel Rental Request",-1)])]),body:S(()=>[t("div",Le,[e(o)?(r(),v("div",Ne,[t("div",We,[u(T,{name:"lucide:alert-circle",class:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),t("p",Ye,R(e(o)),1)])])):y("",!0),i[4]||(i[4]=t("p",{class:"text-base text-foreground"}," Are you sure you want to cancel this rental request? Your reserved funds will be released back to your wallet. ",-1)),t("div",ze,[t("div",Je,[u(T,{name:"lucide:info",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),i[3]||(i[3]=t("p",{class:"text-sm text-blue-900 dark:text-blue-300"}," This action cannot be undone. The rental request will be deleted and the book owner will be notified. ",-1))])])])]),footer:S(()=>[t("div",Ge,[u(_,{variant:"ghost",onClick:i[0]||(i[0]=m=>c.value=!1),disabled:e(g),class:"hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer"},{default:S(()=>[...i[5]||(i[5]=[j(" Keep Request ",-1)])]),_:1},8,["disabled"]),u(_,{onClick:n,disabled:e(g),loading:e(g),class:"text-white bg-red-600 hover:bg-red-700 focus:ring-red-500 disabled:bg-red-400 disabled:cursor-not-allowed cursor-pointer"},{default:S(()=>[e(g)?y("",!0):(r(),$(T,{key:0,name:"lucide:x",class:"w-4 h-4 mr-2"})),j(" "+R(e(g)?"Cancelling...":"Cancel Request"),1)]),_:1},8,["disabled","loading"])])]),_:1},8,["open"])}}}),Ke=Object.assign(He,{__name:"RentalCancelModal"}),Qe={class:"space-y-4"},Xe={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3 dark:bg-red-900/20 dark:border-red-800"},Ze={class:"flex items-start gap-2"},et={class:"text-sm text-red-900 dark:text-red-300"},tt={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-3 dark:bg-blue-900/20 dark:border-blue-800"},nt={class:"flex items-start gap-2"},st={class:"text-sm text-blue-800 dark:text-blue-400"},rt={key:2,class:"bg-amber-50 border border-amber-200 rounded-lg p-3 dark:bg-amber-900/20 dark:border-amber-800"},ot={class:"flex items-start gap-2"},lt={class:"text-sm text-amber-800 dark:text-amber-400"},at={class:"block text-sm font-medium mb-2"},it={key:0,class:"text-amber-600 font-normal ml-2"},ct=["disabled"],dt={key:0,class:"text-red-600 text-sm mt-1 flex items-center gap-1"},ut={class:"bg-blue-50 border border-blue-200 rounded-lg p-3 dark:bg-blue-900/20 dark:border-blue-800"},mt={class:"flex items-start gap-2"},pt={class:"w-full flex justify-end gap-3"},ft=q({__name:"RentalApprovalModal",props:D({rentalId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:D(["submit","success"],["update:modelValue"]),setup(l,{emit:h}){const a=l,c=H(l,"modelValue"),p=h,{lendings:w,fetchUserLendings:d}=X(),{approveRental:g,loading:o}=Y(),n=Z({meetupTime:""}),s=P(""),i=P(""),T=I(()=>w.value.find(f=>f.rental_id===a.rentalId)),_=I(()=>T.value?.meetup_time_window||""),b=I(()=>T.value?.meetup_location||""),m=f=>{if(!f)return null;const x=f.split("-").map(B=>B.trim());if(x.length!==2)return null;const C=B=>{const O=B.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!O)return null;let A=parseInt(O[1]);const z=parseInt(O[2]),L=O[3].toUpperCase();return L==="PM"&&A!==12&&(A+=12),L==="AM"&&A===12&&(A=0),A*60+z};return{start:C(x[0]),end:C(x[1])}},k=()=>{if(s.value="",!n.meetupTime||!_.value)return!0;const f=m(_.value);if(!f||f.start===null||f.end===null)return!0;const[x,C]=n.meetupTime.split(":").map(Number),B=x*60+C;return B<f.start||B>f.end?(s.value=`Time must be between ${_.value}`,!1):!0};E(()=>n.meetupTime,()=>{n.meetupTime&&k()});const M=async()=>{if(i.value="",!n.meetupTime){i.value="Please fill in the meetup time";return}if(!k())return;const f=await g(a.rentalId,n.meetupTime);f.success?(p("submit",{rentalId:a.rentalId,meetupTime:n.meetupTime}),p("success"),c.value=!1,await d()):i.value=f.error||"Failed to approve rental"};return E(c,f=>{f||(n.meetupTime="",s.value="",i.value="")}),E(c,async f=>{f&&w.value.length===0&&await d()}),(f,x)=>{const C=U,B=K,O=Q;return r(),$(O,{open:c.value,"onUpdate:open":x[2]||(x[2]=A=>c.value=A)},{header:S(()=>[...x[3]||(x[3]=[t("h2",{class:"text-2xl font-semibold"},"Set Meetup Details",-1)])]),body:S(()=>[t("div",Qe,[x[8]||(x[8]=t("p",{class:"text-muted"},"Please provide the meetup time for the book handoff.",-1)),e(i)?(r(),v("div",Xe,[t("div",Ze,[u(C,{name:"lucide:alert-circle",class:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),t("p",et,R(e(i)),1)])])):y("",!0),e(b)?(r(),v("div",tt,[t("div",nt,[u(C,{name:"lucide:map-pin",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),t("div",null,[x[4]||(x[4]=t("p",{class:"text-sm font-medium text-blue-900 dark:text-blue-300"}," Requested Meetup Location ",-1)),t("p",st,R(e(b)),1)])])])):y("",!0),e(_)?(r(),v("div",rt,[t("div",ot,[u(C,{name:"lucide:clock",class:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),t("div",null,[x[5]||(x[5]=t("p",{class:"text-sm font-medium text-amber-900 dark:text-amber-300"}," Requested Time Window ",-1)),t("p",lt,R(e(_)),1)])])])):y("",!0),t("div",null,[t("label",at,[x[6]||(x[6]=j(" Meetup Time ",-1)),e(_)?(r(),v("span",it," *Must be within the requested time window above ")):y("",!0)]),ee(t("input",{"onUpdate:modelValue":x[0]||(x[0]=A=>e(n).meetupTime=A),type:"time",class:F(["w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 bg-white dark:bg-gray-800",e(s)?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500"]),disabled:e(o),required:""},null,10,ct),[[te,e(n).meetupTime]]),e(s)?(r(),v("p",dt,[u(C,{name:"lucide:alert-circle",class:"w-4 h-4"}),j(" "+R(e(s)),1)])):y("",!0)]),t("div",ut,[t("div",mt,[u(C,{name:"lucide:info",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),x[7]||(x[7]=t("p",{class:"text-sm text-blue-900 dark:text-blue-300"}," The renter will be notified of the meetup time. You can confirm the book handoff once you meet at the requested location. This meetup time will be used for both pickup and return. ",-1))])])])]),footer:S(()=>[t("div",pt,[u(B,{variant:"ghost",onClick:x[1]||(x[1]=A=>c.value=!1),color:"error",disabled:e(o),class:"color-red-500 hover:bg-red-100 hover:text-red-600 cursor-pointer"},{default:S(()=>[...x[9]||(x[9]=[j(" Cancel ",-1)])]),_:1},8,["disabled"]),u(B,{onClick:M,disabled:!!e(s)||e(o),loading:e(o),class:"text-white bg-green-600 hover:bg-green-700 focus:ring-green-500 cursor-pointer"},{default:S(()=>[e(o)?y("",!0):(r(),$(C,{key:0,name:"lucide:check",class:"w-4 h-4 mr-2"})),j(" "+R(e(o)?"Approving...":"Confirm Approval"),1)]),_:1},8,["disabled","loading"])])]),_:1},8,["open"])}}}),bt=Object.assign(ft,{__name:"RentalApprovalModal"}),gt={class:"space-y-4"},_t={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3 dark:bg-red-900/20 dark:border-red-800"},ht={class:"flex items-start gap-2"},xt={class:"text-sm text-red-900 dark:text-red-300"},vt={class:"bg-amber-50 border border-amber-200 rounded-lg p-3 dark:bg-amber-900/20 dark:border-amber-800"},kt={class:"flex items-start gap-2"},yt={class:"space-y-2"},wt=["onClick","disabled"],Rt={class:"flex items-center gap-3"},$t={key:0,class:"w-3 h-3 rounded-full bg-blue-500"},Ct={class:"text-sm"},jt={class:"bg-blue-50 border border-blue-200 rounded-lg p-3 dark:bg-blue-900/20 dark:border-blue-800"},Tt={class:"flex items-start gap-2"},St={class:"w-full flex justify-end gap-3"},Pt=q({__name:"RentalRejectModal",props:D({rentalId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:D(["success"],["update:modelValue"]),setup(l,{emit:h}){const a=l,c=H(l,"modelValue"),p=h,{fetchUserLendings:w}=X(),{rejectRental:d,loading:g}=Y(),o=Z({reason:""}),n=P(""),s=["Book is no longer available","Cannot meet at the requested time/location","Changed my mind about lending"],i=_=>{o.reason=_},T=async()=>{if(n.value="",!o.reason){n.value="Please select a reason for rejection";return}const _=await d(a.rentalId,o.reason);_.success?(p("success"),c.value=!1,await w()):n.value=_.error||"Failed to reject rental"};return E(c,_=>{_||(o.reason="",n.value="")}),(_,b)=>{const m=U,k=K,M=Q;return r(),$(M,{open:c.value,"onUpdate:open":b[1]||(b[1]=f=>c.value=f)},{header:S(()=>[...b[2]||(b[2]=[t("h2",{class:"text-2xl font-semibold"},"Reject Rental Request",-1)])]),body:S(()=>[t("div",gt,[b[6]||(b[6]=t("p",{class:"text-muted"},"Please provide a reason for rejecting this rental request. This will help the renter understand your decision.",-1)),e(n)?(r(),v("div",_t,[t("div",ht,[u(m,{name:"lucide:alert-circle",class:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),t("p",xt,R(e(n)),1)])])):y("",!0),t("div",vt,[t("div",kt,[u(m,{name:"lucide:alert-triangle",class:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),b[3]||(b[3]=t("p",{class:"text-sm text-amber-900 dark:text-amber-300"}," This action cannot be undone. The renter will be notified of the rejection. ",-1))])]),t("div",null,[b[4]||(b[4]=t("label",{class:"block text-sm font-medium mb-2"},[j(" Select a Reason "),t("span",{class:"text-red-500"},"*")],-1)),t("div",yt,[(r(),v(W,null,ne(s,f=>t("button",{key:f,type:"button",onClick:x=>i(f),class:F(["w-full text-left px-4 py-3 rounded-lg border transition-all",e(o).reason===f?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-300":"border-gray-300 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-700",e(g)?"opacity-50 cursor-not-allowed":"cursor-pointer"]),disabled:e(g)},[t("div",Rt,[t("div",{class:F(["w-5 h-5 rounded-full border-2 flex items-center justify-center",e(o).reason===f?"border-blue-500":"border-gray-300 dark:border-gray-600"])},[e(o).reason===f?(r(),v("div",$t)):y("",!0)],2),t("span",Ct,R(f),1)])],10,wt)),64))])]),t("div",jt,[t("div",Tt,[u(m,{name:"lucide:info",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),b[5]||(b[5]=t("p",{class:"text-sm text-blue-900 dark:text-blue-300"}," The rental entry will be deleted and reserved funds will be released back to the renter. The renter will receive a notification with your reason for rejection. ",-1))])])])]),footer:S(()=>[t("div",St,[u(k,{variant:"ghost",onClick:b[0]||(b[0]=f=>c.value=!1),disabled:e(g),class:"hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer"},{default:S(()=>[...b[7]||(b[7]=[j(" Cancel ",-1)])]),_:1},8,["disabled"]),u(k,{onClick:T,disabled:!e(o).reason||e(g),loading:e(g),class:"text-white bg-red-600 hover:bg-red-700 focus:ring-red-500 disabled:bg-red-400 disabled:cursor-not-allowed cursor-pointer"},{default:S(()=>[e(g)?y("",!0):(r(),$(m,{key:0,name:"lucide:x",class:"w-4 h-4 mr-2"})),j(" "+R(e(g)?"Rejecting...":"Reject Request"),1)]),_:1},8,["disabled","loading"])])]),_:1},8,["open"])}}}),Mt=Object.assign(Pt,{__name:"RentalRejectModal"}),At={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},It={class:"flex items-start gap-3"},Bt={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},qt={class:"flex items-start gap-3"},Ut={class:"flex gap-3 mt-4"},Ot=q({__name:"RentalPendingActions",props:{from:{},rentalId:{},timeWindow:{}},emits:["approval-success","rejection-success","cancel-success","refresh"],setup(l,{emit:h}){const a=h,c=P(!1),p=P(!1),w=P(!1),d=G(),g=()=>{w.value=!0},o=()=>{c.value=!0},n=()=>{p.value=!0},s=()=>{d.add({title:"Success",description:"Rental approved successfully!",icon:"i-lucide-check-circle"}),a("approval-success")},i=()=>{d.add({title:"Rental Status Changed",description:"This book has been approved for another renter. Refreshing...",icon:"i-lucide-info"}),a("refresh")},T=()=>{d.add({title:"Rental Rejected",description:"The rental request has been rejected.",icon:"i-lucide-x-circle"}),a("rejection-success"),J("/rentals")},_=()=>{d.add({title:"Request Cancelled",description:"Your rental request has been cancelled.",icon:"i-lucide-x-circle"}),a("cancel-success"),J("/rentals")};return(b,m)=>{const k=U,M=Ke,f=bt,x=Mt;return l.from==="rental"?(r(),v("div",At,[t("div",It,[u(k,{name:"lucide:info",class:"w-5 h-5 text-yellow-600 mt-0.5"}),m[3]||(m[3]=t("div",{class:"flex-1"},[t("p",{class:"text-yellow-800 font-medium"},"Request Pending: Please wait for the request to be approved by the owner.")],-1))]),t("button",{onClick:g,class:"mt-4 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer"}," Cancel Request "),u(M,{modelValue:e(w),"onUpdate:modelValue":m[0]||(m[0]=C=>N(w)?w.value=C:null),"rental-id":l.rentalId,onSuccess:_},null,8,["modelValue","rental-id"])])):l.from==="lending"?(r(),v("div",Bt,[t("div",qt,[u(k,{name:"lucide:info",class:"w-5 h-5 text-blue-600 mt-0.5"}),m[4]||(m[4]=t("div",{class:"flex-1"},[t("p",{class:"text-blue-900 font-medium"},[t("strong",null,"Action Required:"),j(" A renter wants to borrow your book. Please approve or reject this request.")])],-1))]),t("div",Ut,[t("button",{onClick:o,class:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 cursor-pointer"},[u(k,{name:"lucide:check",class:"w-4 h-4"}),m[5]||(m[5]=j(" Approve Rental ",-1))]),t("button",{onClick:n,class:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 cursor-pointer"},[u(k,{name:"lucide:x",class:"w-4 h-4"}),m[6]||(m[6]=j(" Reject Rental ",-1))])]),u(f,{modelValue:e(c),"onUpdate:modelValue":m[1]||(m[1]=C=>N(c)?c.value=C:null),"rental-id":l.rentalId,onSuccess:s,onConflict:i},null,8,["modelValue","rental-id"]),u(x,{modelValue:e(p),"onUpdate:modelValue":m[2]||(m[2]=C=>N(p)?p.value=C:null),"rental-id":l.rentalId,onSuccess:T},null,8,["modelValue","rental-id"])])):y("",!0)}}}),Vt=Object.assign(Ot,{__name:"RentalPendingActions"}),Dt={class:"space-y-6"},Et={class:"bg-green-50 border border-green-200 rounded-lg p-5"},Ft={class:"flex items-start gap-3"},Lt={class:"flex-1"},Nt={class:"text-green-900 font-medium text-lg mb-1"},Wt={class:"flex items-center gap-2 mt-2"},Yt={class:"text-green-800 font-bold text-xl"},zt={class:"bg-surface rounded-lg border border-base p-6 py-8"},Jt={class:"text-center"},Gt=q({__name:"RentalCompleteCard",props:{status:{},from:{},actualDeposit:{},item:{}},emits:["show-rating"],setup(l,{emit:h}){const a=l,c=h;I(()=>a.from==="rental"?a.item.from:a.item.to),I(()=>a.from==="rental"?"lender":"renter");const p=()=>{c("show-rating")};return(w,d)=>{const g=U;return r(),v("div",Dt,[t("div",Et,[t("div",Ft,[u(g,{name:"lucide:check-circle",class:"w-6 h-6 text-green-600 mt-0.5 flex-shrink-0"}),t("div",Lt,[t("p",Nt," Security deposit "+R(l.from==="rental"?"has returned to you":"has returned to the renter"),1),t("div",Wt,[u(g,{name:"fluent:book-coins-20-regular",class:"w-5 h-5 text-green-600"}),t("span",Yt,R(a.actualDeposit)+" Readits",1)])])])]),t("div",zt,[t("div",Jt,[u(g,{name:"lucide:check-circle",class:"w-16 h-16 text-green-500 mx-auto mb-4"}),d[0]||(d[0]=t("h2",{class:"text-2xl font-bold mb-2"},"Rental Completed!",-1)),d[1]||(d[1]=t("p",{class:"text-muted mb-6"},"We're glad to have been part of your reading journey. Feel free to explore more titles anytime!",-1)),t("button",{onClick:p,class:"bg-accent hover:bg-accent/90 text-white px-6 py-3 rounded-lg font-medium transition-colors inline-flex items-center gap-2 cursor-pointer"},[u(g,{name:"lucide:star",class:"w-5 h-5"}),j(" Rate "+R(l.from==="rental"?"Lender":"Renter"),1)])])])])}}}),Ht=Object.assign(Gt,{__name:"RentalCompleteCard"}),Kt={class:"space-y-6"},Qt={class:"bg-surface rounded-lg border border-base p-8"},Xt={class:"text-center mb-6"},Zt={class:"text-muted"},en={class:"mb-6"},tn={class:"flex justify-center items-center gap-3 mb-2"},nn=["onClick"],sn={class:"text-center text-sm text-muted"},rn={class:"mb-6"},on={class:"flex gap-3 justify-center"},ln=["disabled"],an=q({__name:"RentalRatingCard",props:{from:{},item:{},rentalId:{}},emits:["back-to-complete"],setup(l,{emit:h}){const a=l,c=h,{submitRating:p}=pe(),w=G(),d=P(0),g=P(""),o=P(!1),n=I(()=>a.from==="rental"?a.item.from:a.item.to),s=_=>{d.value=_,console.log("Rating selected:",_)},i=async()=>{if(console.log("Submitting rating:",d.value),d.value===0){w.add({title:"Rating Required",description:"Please select a rating before submitting.",icon:"i-lucide-alert-circle"});return}o.value=!0;try{const _=await p(a.rentalId,d.value,g.value,a.from);_.success?(w.add({title:"Rating Submitted",description:"Thank you for your feedback!",icon:"i-lucide-check-circle"}),J("/rentals")):w.add({title:"Submission Failed",description:_.error||"Failed to submit rating",icon:"i-lucide-x-circle"})}catch(_){console.error("Error submitting rating:",_),w.add({title:"Submission Failed",description:"An error occurred while submitting your rating",icon:"i-lucide-x-circle"})}finally{o.value=!1}},T=()=>{c("back-to-complete")};return(_,b)=>{const m=U;return r(),v("div",Kt,[t("div",Qt,[t("div",Xt,[u(m,{name:"lucide:star",class:"w-16 h-16 text-amber-500 mx-auto mb-4"}),b[1]||(b[1]=t("h2",{class:"text-2xl font-bold mb-2"},"Rate Your Experience",-1)),t("p",Zt,"How was your experience "+R(l.from==="rental"?"renting from":"lending to")+" "+R(e(n))+"?",1)]),t("div",en,[t("div",tn,[(r(),v(W,null,ne([1,2,3,4,5],k=>t("button",{key:k,onClick:M=>s(k),type:"button",class:"cursor-pointer focus:outline-none rounded-full p-1 transition-all duration-200 hover:scale-125"},[u(m,{name:"lucide:star",class:F(["w-14 h-14 transition-all duration-200",k<=e(d)?"text-amber-400 fill-amber-400":"text-gray-300"])},null,8,["class"])],8,nn)),64))]),t("p",sn,R(e(d)===0?"Click to rate":`${e(d)} out of 5 stars`),1)]),t("div",rn,[b[2]||(b[2]=t("label",{class:"block text-sm font-medium mb-2"}," Share your thoughts (Optional) ",-1)),ee(t("textarea",{"onUpdate:modelValue":b[0]||(b[0]=k=>N(g)?g.value=k:null),placeholder:"Tell us about your experience...",rows:"4",class:"w-full px-4 py-3 border border-base rounded-lg focus:outline-none focus:ring-2 focus:ring-accent bg-background"},null,512),[[te,e(g)]])]),t("div",on,[t("button",{onClick:T,class:"px-6 py-3 border border-base rounded-lg font-medium hover:bg-surface transition-colors cursor-pointer"}," Back "),t("button",{onClick:i,disabled:e(d)===0||e(o),class:F(["px-6 py-3 rounded-lg font-medium transition-colors inline-flex items-center gap-2 cursor-pointer",e(d)===0||e(o)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-accent hover:bg-accent/90 text-white"])},[e(o)?(r(),$(m,{key:0,name:"lucide:loader-2",class:"w-5 h-5 animate-spin"})):(r(),$(m,{key:1,name:"lucide:send",class:"w-5 h-5"})),j(" "+R(e(o)?"Submitting...":"Submit Rating"),1)],10,ln)])])])}}}),cn=Object.assign(an,{__name:"RentalRatingCard"}),dn={class:"min-h-screen w-full pt-4 pb-6 px-4 md:px-8 lg:px-15"},un={class:"mb-6"},mn={class:"font-bold text-3xl flex items-center gap-2 mb-1"},pn={key:0,class:"bg-surface rounded-lg border border-base p-12"},fn={class:"flex justify-center items-center"},bn={class:"text-center"},gn={key:1,class:"bg-surface rounded-lg border border-base p-12"},_n={class:"flex justify-center items-center"},hn={class:"text-center"},xn={key:2,class:"space-y-6"},In=q({__name:"[rentalId]",setup(l){const h=le(),a=ae(),c=h.params.rentalId,p=h.query.from,{rentals:w,fetchUserRentals:d}=se(),{lendings:g,fetchUserLendings:o}=X(),n=P(null),s=P(!0),i=P(!1),T=I(()=>n.value?i.value?"rate_user":n.value.rent_status:""),_=async()=>{s.value=!0;try{p==="rental"?(await d(),n.value=w.value.find(M=>M.rental_id===c)||null):p==="lending"&&(await o(),console.log(g.value),n.value=g.value.find(M=>(console.log("Checking:",M.rental_id,"==",c),M.rental_id===c))||null,console.log(n.value))}catch(M){console.error("Error fetching rental data:",M)}finally{s.value=!1}},b=async()=>{await _()},m=()=>{i.value=!0},k=()=>{i.value=!1};return ie(()=>{_()}),(M,f)=>{const x=U,C=ce,B=ge,O=we,A=de,z=ue,L=Fe,re=Vt;return r(),v("div",dn,[t("div",un,[t("button",{onClick:f[0]||(f[0]=vn=>e(a).back()),class:"flex items-center gap-2 text-base pt-4 pb-4 hover:text-foreground mb-4 cursor-pointer"},[u(x,{name:"lucide:arrow-left",class:"w-5 h-5"}),f[1]||(f[1]=t("span",null,"Back to Rentals",-1))]),t("h1",mn,[u(x,{name:e(p)==="rental"?"lucide:trending-down":"lucide:trending-up",class:"w-8 h-8 text-orange-500"},null,8,["name"]),j(" "+R(e(p)==="rental"?"Rental Details":"Lending Details"),1)])]),e(s)?(r(),v("div",pn,[t("div",fn,[t("div",bn,[u(x,{name:"lucide:loader-2",class:"w-12 h-12 text-muted mx-auto animate-spin"}),f[2]||(f[2]=t("p",{class:"text-muted mt-4 text-lg"},"Loading details...",-1))])])])):e(n)?(r(),v("div",xn,[e(n).rent_status!=="completed"?(r(),$(C,{key:0,item:e(n),from:e(p)},null,8,["item","from"])):y("",!0),e(n).rent_status!=="pending"?(r(),$(B,{key:1,status:e(T),from:e(p)},null,8,["status","from"])):y("",!0),e(n).rent_status==="ongoing"?(r(),$(O,{key:2,from:e(p),"rent-end-date":e(n).rent_end_date},null,8,["from","rent-end-date"])):y("",!0),e(n).rent_status!=="completed"?(r(),$(A,{key:3,item:e(n),from:e(p)},null,8,["item","from"])):y("",!0),e(n).rent_status!=="completed"?(r(),$(z,{key:4,cost:e(n).cost,"all-fees-captured":e(n).all_fees_captured,from:e(p),"actual-deposit":e(n).actual_deposit,"actual-rate":e(n).actual_rate,"rental-duration-days":e(n).rental_duration_days},null,8,["cost","all-fees-captured","from","actual-deposit","actual-rate","rental-duration-days"])):y("",!0),e(n).rent_status==="completed"?(r(),v(W,{key:5},[e(i)?(r(),$(cn,{key:1,from:e(p),item:e(n),"rental-id":e(c),onBackToComplete:k},null,8,["from","item","rental-id"])):(r(),$(Ht,{key:0,status:e(n).rent_status,"actual-deposit":e(n).actual_deposit,from:e(p),item:e(n),onShowRating:m},null,8,["status","actual-deposit","from","item"]))],64)):y("",!0),e(n).rent_status==="approved"||e(n).rent_status==="ongoing"||e(n).rent_status==="awaiting_pickup_confirmation"||e(n).rent_status==="awaiting_return_confirmation"?(r(),$(L,{key:6,status:e(n).rent_status,from:e(p),"rental-id":e(c),"meetup-date":e(n).meetup_date,"meetup-time":e(n).meetup_time,"rent-end-date":e(n).rent_end_date,"user-confirmed-pickup":e(n).user_confirmed_pickup,"owner-confirmed-pickup":e(n).owner_confirmed_pickup,"user-confirmed-return":e(n).user_confirmed_return,"owner-confirmed-return":e(n).owner_confirmed_return,onRefresh:_},null,8,["status","from","rental-id","meetup-date","meetup-time","rent-end-date","user-confirmed-pickup","owner-confirmed-pickup","user-confirmed-return","owner-confirmed-return"])):y("",!0),e(n).rent_status==="pending"?(r(),$(re,{key:7,from:e(p),"rental-id":e(c),onApprovalSuccess:b,onRefresh:_},null,8,["from","rental-id"])):y("",!0)])):(r(),v("div",gn,[t("div",_n,[t("div",hn,[u(x,{name:"lucide:alert-circle",class:"w-16 h-16 text-red-500 mx-auto"}),f[3]||(f[3]=t("p",{class:"text-red-500 mt-4 text-lg"},"Rental not found",-1))])])]))])}}});export{In as default};
