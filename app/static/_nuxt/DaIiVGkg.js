import{q as h,ai as q,j as U,h as C,o,_ as H,w as O,a as e,t as _,b as n,k as I,C as j,A as F,c as m,i as u,Q as z,B as A,F as L,J as T,x as D,az as R,y as E,f as M,d as V,n as J}from"#entry";import{_ as Q}from"./DVL47Mpl.js";import{_ as G}from"./CoCDlcmg.js";import{_ as K}from"./DwI7OayI.js";import{u as W,a as X}from"./CHCiICDL.js";import"./BYnHXhte.js";import"./BX4pJY_y.js";import"./C7gYzAMW.js";import"./CxmxAOEW.js";import"./DNBF-Q6I.js";import"./QkSgYxCE.js";import"./DJUnOCSR.js";const Y="http://127.0.0.1:8080",Z=()=>{const c=h(0),t=h(!0),p=h(null),{$apiFetch:l}=q();return{completedPurchasesCount:c,loading:t,error:p,fetchUserCompletedPurchasesCount:async()=>{t.value=!0,p.value=null;try{const s=await l(`${Y}/api/purchases/my-completed-purchases-count`,{credentials:"include"});c.value=s.count}catch(s){c.value=0,console.log("No purchases found or error fetching purchase count:",s)}finally{t.value=!1}}}},ee="http://127.0.0.1:8080",te=()=>{const c=h(0),t=h(!0),p=h(null),{$apiFetch:l}=q();return{completedSalesCount:c,loading:t,error:p,fetchUserCompletedSalesCount:async()=>{t.value=!0,p.value=null;try{const s=await l(`${ee}/api/purchases/my-completed-sales-count`,{credentials:"include"});c.value=s.count}catch(s){c.value=0,console.log("No sales found or error fetching sales count:",s)}finally{t.value=!1}}}},se={class:"bg-surface rounded-lg border border-base px-6 py-5 hover:shadow-md transition-shadow"},ae={class:"flex justify-between items-start"},oe={class:"flex-1"},ne={class:"text-xl font-bold text-foreground mb-2"},re={class:"flex items-center gap-4 text-sm text-muted"},ce={class:"flex items-center gap-1"},le={class:"flex items-center gap-1"},ie={class:"flex items-center gap-3"},de={class:"flex items-center gap-1"},ue={class:"text-accent text-xl font-bold"},me=U({__name:"PurchaseHistoryCard",props:{purchase:{}},setup(c){const t=c,p=l=>{try{const[i,s,f]=l.split("-").map(Number),w=Number(s),x=Number(f),g=Number(i);return new Date(g,w-1,x).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return"null"}};return(l,i)=>{const s=I,f=H;return o(),C(f,{to:{path:`/purchases/history/${t.purchase.purchase_id}`,query:{from:"purchase"}},class:"block"},{default:O(()=>[e("div",se,[e("div",ae,[e("div",oe,[e("h3",ne,_(t.purchase.title),1),e("div",re,[e("div",ce,[n(s,{name:"lucide:user",class:"w-4 h-4"}),e("span",null,"Bought from "+_(t.purchase.from),1)]),e("div",le,[n(s,{name:"lucide:calendar",class:"w-4 h-4"}),e("span",null,_(p(t.purchase.meetup_date)),1)])])]),e("div",ie,[e("div",de,[i[0]||(i[0]=e("span",{class:"text-accent text-xl font-bold"},"-",-1)),n(s,{name:"fluent:book-coins-20-regular",class:"w-6 h-6 text-accent"}),e("span",ue,_(t.purchase.cost),1)])])])])]),_:1},8,["to"])}}}),pe=Object.assign(me,{__name:"PurchaseHistoryCard"}),_e={class:"bg-surface rounded-lg border border-base px-6 py-5 hover:shadow-md transition-shadow"},he={class:"flex justify-between items-start"},fe={class:"flex-1"},ge={class:"text-xl font-bold text-foreground mb-2"},xe={class:"flex items-center gap-4 text-sm text-muted"},ve={class:"flex items-center gap-1"},be={class:"flex items-center gap-1"},ye={class:"flex items-center gap-3"},we={class:"flex items-center gap-1"},$e={class:"text-accent text-xl font-bold"},Pe=U({__name:"SaleHistoryCard",props:{sale:{}},setup(c){const t=c,p=l=>{const[i,s,f]=l.split("-").map(Number),w=Number(s),x=Number(f),g=Number(i);return new Date(g,w-1,x).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})};return(l,i)=>{const s=I,f=H;return o(),C(f,{to:{path:`/purchases/history/${t.sale.purchase_id}`,query:{from:"sale"}},class:"block"},{default:O(()=>[e("div",_e,[e("div",he,[e("div",fe,[e("h3",ge,_(t.sale.title),1),e("div",xe,[e("div",ve,[n(s,{name:"lucide:user",class:"w-4 h-4"}),e("span",null,"Sold to "+_(t.sale.to),1)]),e("div",be,[n(s,{name:"lucide:calendar",class:"w-4 h-4"}),e("span",null,_(p(t.sale.meetup_date)),1)])])]),e("div",ye,[e("div",we,[i[0]||(i[0]=e("span",{class:"text-accent text-xl font-bold"},"+",-1)),n(s,{name:"fluent:book-coins-20-regular",class:"w-6 h-6 text-accent"}),e("span",$e,_(t.sale.cost),1)])])])])]),_:1},8,["to"])}}}),Ce=Object.assign(Pe,{__name:"SaleHistoryCard"}),Se={class:"w-full bg-background"},ke={key:0},Ue={key:0,class:"bg-surface rounded-lg p-6 w-full border border-base"},Ne={class:"flex justify-center items-center"},je={class:"text-center"},Le={key:1,class:"bg-surface rounded-lg p-6 w-full border border-base"},Te={class:"flex justify-center items-center"},He={class:"text-center"},Oe={class:"text-red-500 mt-4 text-lg"},Ie={key:2,class:"bg-surface rounded-lg p-6 w-full border border-base"},Be={class:"flex justify-center items-center"},Ae={class:"text-center"},De={key:3,class:"space-y-4"},Ve={key:1},qe={key:0,class:"bg-surface rounded-lg p-6 w-full border border-base"},Fe={class:"flex justify-center items-center"},ze={class:"text-center"},Re={key:1,class:"bg-surface rounded-lg p-6 w-full border border-base"},Ee={class:"flex justify-center items-center"},Me={class:"text-center"},Je={class:"text-red-500 mt-4 text-lg"},Qe={key:2,class:"bg-surface rounded-lg p-6 w-full border border-base"},Ge={class:"flex justify-center items-center"},Ke={class:"text-center"},We={key:3,class:"space-y-4"},Xe=U({__name:"PurchasesHistorySection",props:{activeTab:{},sortOrder:{},cardsPerPage:{}},setup(c){const t=c,{purchases:p,loading:l,error:i,fetchUserCompletedPurchases:s}=W(),{completedPurchasesCount:f,loading:w,fetchUserCompletedPurchasesCount:x}=Z(),{sales:g,loading:P,error:v,fetchUserCompletedSales:r}=X(),{completedSalesCount:S,loading:k,fetchUserCompletedSalesCount:N}=te(),d=h(1);return j([()=>t.sortOrder,()=>t.cardsPerPage,d],async b=>{t.activeTab==="buying"?await s(b[0],b[1],d.value):await r(b[0],b[1],d.value)}),j(()=>t.activeTab,async b=>{d.value=1,b==="buying"?await s(t.sortOrder,t.cardsPerPage,d.value):await r(t.sortOrder,t.cardsPerPage,d.value)}),F(async()=>{await x(),await N(),t.activeTab==="buying"?await s(t.sortOrder,t.cardsPerPage,d.value):await r(t.sortOrder,t.cardsPerPage,d.value)}),(b,a)=>{const $=z,B=K;return o(),m("div",Se,[c.activeTab==="selling"?(o(),m("div",ke,[u(P)?(o(),m("div",Ue,[e("div",Ne,[e("div",je,[n($,{name:"lucide:loader-2",class:"w-8 h-8 text-muted mx-auto animate-spin"}),a[2]||(a[2]=e("p",{class:"text-muted mt-4 text-lg"},"Loading your past sales...",-1))])])])):u(v)?(o(),m("div",Le,[e("div",Te,[e("div",He,[n($,{name:"lucide:alert-circle",class:"w-16 h-16 text-red-500 mx-auto"}),e("p",Oe,_(u(v)),1)])])])):u(g).length===0?(o(),m("div",Ie,[e("div",Be,[e("div",Ae,[n($,{name:"bytesize:book",class:"w-16 h-16 text-muted mx-auto"}),a[3]||(a[3]=e("p",{class:"text-muted mt-4 text-lg"},"No past sales yet...",-1))])])])):(o(),m("div",De,[(o(!0),m(L,null,T(u(g),y=>(o(),C(Ce,{key:y.purchase_id,sale:y},null,8,["sale"]))),128)),u(k)?A("",!0):(o(),C(B,{key:0,page:u(d),"onUpdate:page":a[0]||(a[0]=y=>D(d)?d.value=y:null),"items-per-page":c.cardsPerPage,total:u(S),class:"w-full flex justify-center"},null,8,["page","items-per-page","total"]))]))])):(o(),m("div",Ve,[u(l)?(o(),m("div",qe,[e("div",Fe,[e("div",ze,[n($,{name:"lucide:loader-2",class:"w-8 h-8 text-muted mx-auto animate-spin"}),a[4]||(a[4]=e("p",{class:"text-muted mt-4 text-lg"},"Loading your past purchases...",-1))])])])):u(i)?(o(),m("div",Re,[e("div",Ee,[e("div",Me,[n($,{name:"lucide:alert-circle",class:"w-16 h-16 text-red-500 mx-auto"}),e("p",Je,_(u(i)),1)])])])):u(p).length===0?(o(),m("div",Qe,[e("div",Ge,[e("div",Ke,[n($,{name:"bytesize:book",class:"w-16 h-16 text-muted mx-auto"}),a[5]||(a[5]=e("p",{class:"text-muted mt-4 text-lg"},"No past purchases yet...",-1))])])])):(o(),m("div",We,[(o(!0),m(L,null,T(u(p),y=>(o(),C(pe,{key:y.purchase_id,purchase:y},null,8,["purchase"]))),128)),u(w)?A("",!0):(o(),C(B,{key:0,page:u(d),"onUpdate:page":a[1]||(a[1]=y=>D(d)?d.value=y:null),"items-per-page":c.cardsPerPage,total:u(f),class:"w-full flex justify-center"},null,8,["page","items-per-page","total"]))]))]))])}}}),Ye=Object.assign(Xe,{__name:"PurchasesHistorySection"}),Ze={class:"flex flex-col h-auto w-full pt-4 px-4 md:px-8 lg:px-15"},et={class:"mb-6 flex justify-between items-start"},tt={class:"text-base"},st={class:"font-bold text-3xl flex items-center gap-2 mb-1"},at={class:"w-full bg-background"},ot={class:"mx-auto"},nt={class:"grid grid-cols-2 gap-3 mb-6"},rt=["onClick"],ct={class:"flex items-center justify-center gap-1"},lt={class:"text-sm leading-tight"},it={class:"flex mb-6"},dt={class:"flex-1 text-xl font-bold text-foreground"},ut={class:"flex-[3] flex justify-center gap-2"},mt={class:"flex items-center gap-2"},pt={class:"flex items-center gap-2"},_t={class:"flex-1 flex justify-end items-center"},kt=U({__name:"index",setup(c){const t=h("buying"),l=R().query.activeTab;l&&!Array.isArray(l)&&(l==="selling"||l==="buying")&&(t.value=l),E({query:{activeTab:t.value}},{replace:!0});const i=[{id:"selling",label:"Books I Sold",icon:"lucide:trending-up"},{id:"buying",label:"Books I Bought",icon:"lucide:trending-down"}],s=M(()=>t.value==="selling"?"Sale History":"Purchase History"),f=h(["newest first","oldest first"]),w=h([10,25,50]),x=h("newest first"),g=h(10),P=v=>{const r=new URL(window.location.href);r.searchParams.set("activeTab",v),window.history.replaceState({},"",r.toString())};return P(t.value),j(t,v=>{P(v)}),(v,r)=>{const S=I,k=Q,N=G,d=H,b=Ye;return o(),m("div",Ze,[e("div",et,[e("div",tt,[e("h1",st,[n(S,{name:"fluent:calendar-24-regular",class:"w-8 h-8 text-orange-500"}),r[2]||(r[2]=V(" My Sell And Purchase History ",-1))]),r[3]||(r[3]=e("p",{class:"text-muted"},"See your selling and buying activity",-1))])]),e("div",at,[e("div",ot,[e("div",nt,[(o(),m(L,null,T(i,a=>e("button",{key:a.id,class:J(["px-4 py-3 rounded-lg font-medium transition-all text-center cursor-pointer",t.value===a.id?"bg-accent text-white":"bg-surface text-foreground hover:bg-surface-hover"]),onClick:$=>t.value=a.id},[e("div",ct,[n(S,{name:a.icon},null,8,["name"]),e("span",lt,_(a.label),1)])],10,rt)),64))])])]),e("div",it,[e("h2",dt,_(s.value),1),e("div",ut,[e("div",mt,[r[4]||(r[4]=e("p",null,"Show",-1)),n(k,{modelValue:x.value,"onUpdate:modelValue":r[0]||(r[0]=a=>x.value=a),items:f.value,class:"w-45"},null,8,["modelValue","items"])]),n(N,{orientation:"vertical",color:"primary",size:"sm"}),e("div",pt,[n(k,{modelValue:g.value,"onUpdate:modelValue":r[1]||(r[1]=a=>g.value=a),items:w.value,class:"w-20"},null,8,["modelValue","items"]),r[5]||(r[5]=e("p",null,"cards per page",-1))])]),e("div",_t,[n(d,{to:{path:"/purchases",query:{activeTab:t.value}},class:"text-foreground font-medium flex gap-1 cursor-pointer"},{default:O(()=>[V(" Current "+_(t.value==="selling"?"sold":"purchases")+" ",1),n(S,{name:"lucide:move-right",class:"w-6 h-6 text-foreground"})]),_:1},8,["to"])])]),n(b,{"sort-order":x.value,"cards-per-page":g.value,"active-tab":t.value},null,8,["sort-order","cards-per-page","active-tab"])])}}});export{kt as default};
