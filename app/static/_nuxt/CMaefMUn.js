import{j as z,az as B,v as D,q as d,y as N,f as P,c,o as m,a as t,M as T,b as r,w as p,l as U,i as s,x as k,B as S,k as O,d as E,t as j,n as G,_ as H}from"#entry";import{_ as I}from"./CBf3hF8c.js";import{u as W,_ as L}from"./B5arrEhJ.js";import{a as F}from"./R0OndqsU.js";import"./DGycg10u.js";const Y={class:"flex-1 w-full flex flex-col bg-background"},J={class:"flex-grow flex items-center justify-center p-4"},K={class:"p-10 w-full max-w-xl"},Q={class:"space-y-2"},X={class:"space-y-2"},Z={key:0,class:"mt-2 text-sm text-red-500 dark:text-red-400 flex items-start gap-1"},ee={class:"space-y-2"},se={key:0,class:"mt-2 text-sm"},te={key:0,class:"flex items-center gap-2 text-green-500"},oe={key:1,class:"flex items-center gap-2 text-red-500"},ae={class:"text-center mt-4"},ce=z({__name:"change-password-new",setup(re){const A=B(),w=D(),o=d(!1),f=d(!1),g=d(!1),v=d(!1),C=d(A.query.code||""),u=d(""),n=d(""),i=d(""),{validatePassword:R}=W();C.value||N("/users/me");const x=P(()=>n.value?R(n.value):{valid:!1,errors:[],strength:"weak",percentage:0}),y=P(()=>n.value===i.value&&i.value.length>0),V=P(()=>u.value.length>=8&&x.value.valid&&y.value&&!o.value),q=async()=>{if(!(o.value||!V.value)){if(!x.value.valid){w.add({title:"Invalid Password",description:x.value.errors[0]||"Password does not meet requirements.",color:"error"});return}if(!y.value){w.add({title:"Passwords Do Not Match",description:"Please make sure both passwords are the same.",color:"error"});return}o.value=!0;try{console.log("[CHANGE PASSWORD] Changing password");const a=await F(C.value,u.value,n.value);console.log("[CHANGE PASSWORD] Response:",a),w.add({title:a.messageTitle||"Password Changed!",description:a.message||"Your password has been successfully changed.",color:"success"}),await new Promise(e=>setTimeout(e,1500)),N("/users/me")}catch(a){console.error("[CHANGE PASSWORD] Error:",a);let e="An unexpected error occurred.";a?.data?.error?e=a.data.error:a?.message?e=a.message:a?.error&&(e=a.error),w.add({title:"Change Password Failed",description:e,color:"error"}),o.value=!1}}};return(a,e)=>{const h=U,b=I,M=L,_=O,$=H;return m(),c("div",Y,[t("main",J,[t("div",K,[e[13]||(e[13]=t("div",{class:"mb-8 text-center"},[t("h2",{class:"text-4xl font-extrabold text-gray-900 dark:text-white mb-3"}," Change your password "),t("p",{class:"text-lg text-gray-600 dark:text-gray-400"}," Enter your current password and choose a new strong password. ")],-1)),t("form",{class:"space-y-5",onSubmit:T(q,["prevent"])},[t("div",Q,[e[6]||(e[6]=t("label",{for:"currentPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Current Password ",-1)),r(b,{id:"currentPassword",modelValue:s(u),"onUpdate:modelValue":e[1]||(e[1]=l=>k(u)?u.value=l:null),type:s(f)?"text":"password",placeholder:"Enter current password",class:"w-full",disabled:s(o),ui:{trailing:"pe-1"},required:""},{trailing:p(()=>[r(h,{color:"neutral",variant:"link",size:"sm",icon:s(f)?"heroicons:eye-slash":"heroicons:eye",disabled:s(o),onClick:e[0]||(e[0]=l=>f.value=!s(f))},null,8,["icon","disabled"])]),_:1},8,["modelValue","type","disabled"])]),t("div",X,[e[8]||(e[8]=t("label",{for:"newPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," New Password ",-1)),r(b,{id:"newPassword",modelValue:s(n),"onUpdate:modelValue":e[3]||(e[3]=l=>k(n)?n.value=l:null),type:s(g)?"text":"password",placeholder:"Enter new password",class:"w-full",disabled:s(o),ui:{trailing:"pe-1"},required:""},{trailing:p(()=>[r(h,{color:"neutral",variant:"link",size:"sm",icon:s(g)?"heroicons:eye-slash":"heroicons:eye",disabled:s(o),onClick:e[2]||(e[2]=l=>g.value=!s(g))},null,8,["icon","disabled"])]),_:1},8,["modelValue","type","disabled"]),r(M,{password:s(n),"show-errors":!1},null,8,["password"]),s(n).length>=8&&!s(x).valid?(m(),c("div",Z,[r(_,{name:"heroicons:exclamation-circle-solid",class:"w-5 h-5 flex-shrink-0"}),e[7]||(e[7]=t("span",null,"One special character, number and uppercase letter needed",-1))])):S("",!0)]),t("div",ee,[e[11]||(e[11]=t("label",{for:"confirmPassword",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Confirm New Password ",-1)),r(b,{id:"confirmPassword",modelValue:s(i),"onUpdate:modelValue":e[5]||(e[5]=l=>k(i)?i.value=l:null),type:s(v)?"text":"password",placeholder:"Re-enter new password",class:"w-full",disabled:s(o),ui:{trailing:"pe-1"},required:""},{trailing:p(()=>[r(h,{color:"neutral",variant:"link",size:"sm",icon:s(v)?"heroicons:eye-slash":"heroicons:eye",disabled:s(o),onClick:e[4]||(e[4]=l=>v.value=!s(v))},null,8,["icon","disabled"])]),_:1},8,["modelValue","type","disabled"]),s(i)?(m(),c("div",se,[s(y)?(m(),c("div",te,[r(_,{name:"heroicons:check-circle-solid",class:"w-4 h-4"}),e[9]||(e[9]=t("span",null,"Passwords match",-1))])):(m(),c("div",oe,[r(_,{name:"heroicons:x-circle-solid",class:"w-4 h-4"}),e[10]||(e[10]=t("span",null,"Passwords do not match",-1))]))])):S("",!0)]),r(h,{type:"submit",class:"w-full h-12 rounded-xl cursor-pointer justify-center text-lg font-bold bg-green-600 hover:bg-green-700 text-white",disabled:!s(V),loading:s(o)},{default:p(()=>[E(j(s(o)?"Changing Password...":"Change Password"),1)]),_:1},8,["disabled","loading"]),t("div",ae,[r($,{to:"/users/me",class:G(["text-sm text-violet-700 dark:text-violet-400 hover:text-violet-800 dark:hover:text-violet-300 transition-colors",s(o)?"pointer-events-none opacity-50":""])},{default:p(()=>[...e[12]||(e[12]=[E(" Cancel and go back to profile ",-1)])]),_:1},8,["class"])])],32)])])])}}});export{ce as default};
