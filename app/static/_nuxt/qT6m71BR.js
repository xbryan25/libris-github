import{j as U,az as V,f as E,h,c as d,o as n,_ as z,i as c,w as y,a,m as q,b as i,t as w,B as k,d as I,k as M,ai as A,q as v,C as R,aj as D,A as O,ak as W,Q as J,F as j,J as F,x as Q,S as H}from"#entry";import{_ as K}from"./BvFGTDkj.js";import{_ as X}from"./CoCDlcmg.js";import{_ as Y}from"./BOfFLyal.js";import{_ as Z}from"./DwI7OayI.js";const ee={class:"flex-[2] w-full rounded-t-xl overflow-hidden"},te={class:"flex-1 flex flex-col gap-[10px] px-5 py-4 bg-surface-hover w-full rounded-b-xl"},ae={class:"flex-1 flex flex-col gap-1 items-center pb-1"},oe={class:"text-lg text-center font-semibold text-base truncate w-full"},se={class:"text-left text-xs text-base truncate"},ne={class:"text-left text-xs text-base truncate w-full"},le={class:"flex gap-2 items-start"},ie={class:"flex flex-col gap-1"},re={key:0,class:"flex gap-2 items-center"},ce={class:"flex-1 flex gap-1 items-center"},ue={class:"flex items-center"},de={class:"text-xs text-primary font-semibold"},me={key:1,class:"flex gap-2 items-center"},fe={class:"flex-1 flex gap-1 items-center"},pe={class:"flex items-center"},_e={class:"text-xs text-primary font-semibold"},be={key:2,class:"flex gap-2 items-center h-5"},xe={key:1,class:"w-full h-[400px] flex flex-col items-center justify-center bg-transparent"},he=U({__name:"BookListCard",props:{cardType:{},bookDetails:{}},setup(m){const e=m,f=V(),B=E(()=>{let r="browse",t=`from=${r}`;if(f.path.includes("/collection")){r="user-collection";const u=f.params.id;t=`from=${r}&collectionOwnerId=${u}`}return`/books/${e.bookDetails?.bookId}?${t}`});return(r,t)=>{const u=q,g=K,l=X,p=Y,_=M,S=z;return e.cardType==="hasContent"?(n(),h(S,{key:0,to:c(B),class:"w-full h-[400px] flex flex-col items-center justify-center transition-transform duration-300 hover:scale-103 cursor-pointer"},{default:y(()=>[a("div",ee,[e.bookDetails?.firstImageUrl?(n(),h(u,{key:0,src:e.bookDetails?.firstImageUrl,class:"w-full h-full object-cover",alt:"Auth image"},null,8,["src"])):(n(),h(u,{key:1,src:"/images/noImageImage.jpg",class:"w-full h-full object-cover",alt:"Auth image"}))]),a("div",te,[a("div",ae,[i(g,{text:e.bookDetails?.title},{default:y(()=>[a("p",oe,w(e.bookDetails?.title),1)]),_:1},8,["text"]),i(g,{text:e.bookDetails?.author,class:"flex-[3]"},{default:y(()=>[a("p",se,"by "+w(e.bookDetails?.author),1)]),_:1},8,["text"]),i(l,{color:"primary",type:"solid",class:"flex-1"}),i(g,{text:e.bookDetails?.ownerUsername,class:"flex-[3]"},{default:y(()=>[a("p",ne," Owned by: "+w(e.bookDetails?.ownerUsername),1)]),_:1},8,["text"])]),a("div",le,[["rent","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(n(),h(p,{key:0,class:"font-bold rounded-full"},{default:y(()=>[...t[0]||(t[0]=[I("For Rent",-1)])]),_:1})):k("",!0),["purchase","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(n(),h(p,{key:1,color:"error",class:"font-bold rounded-full"},{default:y(()=>[...t[1]||(t[1]=[I("For Sale",-1)])]),_:1})):k("",!0)]),a("div",ie,[["rent","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(n(),d("div",re,[a("div",ce,[i(_,{name:"solar:clock-circle-bold",class:"w-5 h-5 text-base"}),t[2]||(t[2]=a("p",{class:"flex-1 text-sm font-semibold text-base"},"Rent",-1))]),a("div",ue,[i(_,{name:"fluent:book-coins-20-regular",class:"w-5 h-5 text-accent"}),a("p",de,w(e.bookDetails?.dailyRentPrice)+"/day ",1)])])):k("",!0),["purchase","both"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(n(),d("div",me,[a("div",fe,[i(_,{name:"solar:cart-large-2-bold-duotone",class:"w-5 h-5 text-base"}),t[3]||(t[3]=a("p",{class:"flex-1 text-sm font-semibold text-base"},"Buy",-1))]),a("div",pe,[i(_,{name:"fluent:book-coins-20-regular",class:"w-5 h-5 text-accent"}),a("p",_e,w(e.bookDetails?.purchasePrice),1)])])):k("",!0),["rent","purchase"].includes(e.bookDetails?.availability?e.bookDetails?.availability:"")?(n(),d("div",be)):k("",!0)])])]),_:1},8,["to"])):(n(),d("div",xe))}}}),ke=Object.assign(he,{__name:"BookListCard"});function ge(m){const{$apiFetch:e}=A();return e("/api/books/book-list-books",{method:"GET",credentials:"include",query:{...m||{}}})}function ye(m){const{$apiFetch:e}=A();return e("/api/books/book-list-books-count",{method:"GET",credentials:"include",query:{...m||{}}})}const ve={class:"h-full w-full flex flex-col items-center"},we={class:"flex-1 pt-5 w-full relative"},Be={key:0,class:"absolute inset-0 flex justify-center items-center bg-background z-5"},Se={key:1,class:"absolute inset-0 flex justify-center items-center bg-background z-5"},De=225,Le=U({__name:"BookList",props:{headerState:{},userId:{}},setup(m){const e=m,f=v([]),B=v(null),r=v(1),t=v(1),u=v(0),g=()=>{const o=B.value;if(!o)return 0;const s=o.clientWidth,b=12;return Math.max(1,Math.floor((s+b)/(De+b)))*2},l=v(!1),p=async()=>{const o=g();if(o<=0)return;r.value=o;const s={booksPerPage:r.value,pageNumber:t.value,searchValue:e.headerState.searchValue,bookGenre:e.headerState.selectedBookGenre,bookAvailability:e.headerState.selectedBookAvailability,userId:e.userId,minPrice:e.headerState.selectedPriceRange.minPrice,maxPrice:e.headerState.selectedPriceRange.maxPrice,kmRadius:e.headerState.kmRadius,userLat:e.headerState.userLat,userLng:e.headerState.userLng},b=await ge(s);f.value=b},_=async()=>{const o={searchValue:e.headerState.searchValue,bookGenre:e.headerState.selectedBookGenre,bookAvailability:e.headerState.selectedBookAvailability,userId:e.userId,minPrice:e.headerState.selectedPriceRange.minPrice,maxPrice:e.headerState.selectedPriceRange.maxPrice,kmRadius:e.headerState.kmRadius,userLat:e.headerState.userLat,userLng:e.headerState.userLng},{totalCount:s}=await ye(o);u.value=s},S=()=>{const o=Math.ceil(u.value/r.value)||1;t.value>o&&(t.value=o),u.value===0&&(t.value=1)},N=D(async()=>{await p()},700),T=D(async()=>{await _(),S()},700);let P=0;const C=D(async()=>{await H(),await new Promise(s=>requestAnimationFrame(s)),await new Promise(s=>setTimeout(s,80));const o=g();if(!(o===P||o<=0)){P=o,l.value=!0;try{await p(),S()}finally{l.value=!1}}},400),G=D(async()=>{try{await p(),await _()}catch(o){console.error("Error loading books:",o)}finally{l.value=!1}},700);return R([()=>e.headerState.searchValue,()=>e.headerState.selectedBookAvailability,()=>e.headerState.selectedBookGenre,()=>e.headerState.selectedPriceRange,()=>e.headerState.kmRadius,()=>e.headerState.userLat,()=>e.headerState.userLng],()=>{l.value=!0,t.value=1,G()},{deep:!0}),R(()=>t.value,async()=>{l.value=!0;try{await p()}catch(o){console.error("Error changing page:",o)}finally{l.value=!1}}),O(async()=>{l.value=!0,await N(),await T(),l.value=!1,window.addEventListener("resize",C)}),W(()=>{window.removeEventListener("resize",C)}),(o,s)=>{const b=J,L=ke,$=Z;return n(),d("div",ve,[a("div",we,[c(l)?(n(),d("div",Be,[i(b,{name:"i-heroicons-arrow-path",class:"w-8 h-8 animate-spin text-accent"}),s[1]||(s[1]=a("span",{class:"ml-2 text-muted"},"Loading books...",-1))])):k("",!0),!c(l)&&c(f).length==0?(n(),d("div",Se,[i(b,{name:"heroicons:x-mark-16-solid",class:"w-12 h-12 animate-bounce text-accent"}),s[2]||(s[2]=a("span",{class:"ml-2 text-muted"},"No books here...",-1))])):k("",!0),a("div",{ref_key:"gridContainer",ref:B,class:"grid grid-cols-[repeat(auto-fit,minmax(225px,1fr))] gap-3",style:{"grid-auto-rows":"400px","max-height":"calc(400px * 2 + 12px)","min-height":"calc(400px * 2 + 12px)",overflow:"hidden"}},[(n(!0),d(j,null,F(c(f),x=>(n(),h(L,{key:x.bookId,"card-type":"hasContent","book-details":x},null,8,["book-details"]))),128)),(n(!0),d(j,null,F(Math.max(0,c(r)-c(f).length),x=>(n(),h(L,{key:x,"card-type":"empty"}))),128))],512)]),i($,{page:c(t),"onUpdate:page":s[0]||(s[0]=x=>Q(t)?t.value=x:null),"items-per-page":c(r),"show-edges":"","sibling-count":0,total:c(u),class:"py-5"},null,8,["page","items-per-page","total"])])}}}),je=Object.assign(Le,{__name:"BookList"});export{je as _};
