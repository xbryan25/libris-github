import{E as ge,e as se,f as S,g as M,al as T,am as ie,q as N,an as le,ao as oe,C as Ee,ap as E,aq as we,h as ue,o as x,w as G,a as te,n as v,c as O,B as W,b as Se,i as w,r as I,d as z,t as A,P as qe,ar as xe,as as re,at as ae,A as ne,S as Ie,au as R,av as Fe,z as U,aw as Ne,ax as je,M as Be,N as ke}from"#entry";import{L as $e}from"./xkkEXfMU.js";import{d as Oe}from"./DGycg10u.js";const ze={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between",label:"block font-medium text-default",container:"mt-1 relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}}},defaultVariants:{size:"md"}},Ae=["id"],Ke=["id"],Pe=["id"],Ce=["id"],Qe={__name:"UFormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[Boolean,String],required:!1},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(a){const r=a,l=ge(),n=se(),i=S(()=>M({extend:M(ze),...n.ui?.formField||{}})({size:r.size,required:r.required})),b=T(ie,null),f=S(()=>r.error||b?.value?.find(c=>c.name===r.name||r.errorPattern&&c.name?.match(r.errorPattern))?.message),u=N(le()),h=u.value,j=T(oe,void 0);return Ee(u,()=>{j&&r.name&&(j.value[r.name]={id:u.value,pattern:r.errorPattern})},{immediate:!0}),E(xe,u),E(we,S(()=>({error:f.value,name:r.name,size:r.size,eagerValidation:r.eagerValidation,validateOnInputDelay:r.validateOnInputDelay,errorPattern:r.errorPattern,hint:r.hint,description:r.description,help:r.help,ariaId:h}))),(c,P)=>(x(),ue(w(qe),{as:a.as,class:v(i.value.root({class:[r.ui?.root,r.class]}))},{default:G(()=>[te("div",{class:v(i.value.wrapper({class:r.ui?.wrapper}))},[a.label||l.label?(x(),O("div",{key:0,class:v(i.value.labelWrapper({class:r.ui?.labelWrapper}))},[Se(w($e),{for:u.value,class:v(i.value.label({class:r.ui?.label}))},{default:G(()=>[I(c.$slots,"label",{label:a.label},()=>[z(A(a.label),1)])]),_:3},8,["for","class"]),a.hint||l.hint?(x(),O("span",{key:0,id:`${w(h)}-hint`,class:v(i.value.hint({class:r.ui?.hint}))},[I(c.$slots,"hint",{hint:a.hint},()=>[z(A(a.hint),1)])],10,Ae)):W("",!0)],2)):W("",!0),a.description||l.description?(x(),O("p",{key:1,id:`${w(h)}-description`,class:v(i.value.description({class:r.ui?.description}))},[I(c.$slots,"description",{description:a.description},()=>[z(A(a.description),1)])],10,Ke)):W("",!0)],2),te("div",{class:v([(a.label||!!l.label||a.description||!!l.description)&&i.value.container({class:r.ui?.container})])},[I(c.$slots,"default",{error:f.value}),typeof f.value=="string"&&f.value||l.error?(x(),O("div",{key:0,id:`${w(h)}-error`,class:v(i.value.error({class:r.ui?.error}))},[I(c.$slots,"error",{error:f.value},()=>[z(A(f.value),1)])],10,Pe)):a.help||l.help?(x(),O("div",{key:1,id:`${w(h)}-help`,class:v(i.value.help({class:r.ui?.help}))},[I(c.$slots,"help",{help:a.help},()=>[z(A(a.help),1)])],10,Ce)):W("",!0)],2)]),_:3},8,["as","class"]))}};function De(a){return"schema"in a&&typeof a.coercer=="function"&&typeof a.validator=="function"&&typeof a.refiner=="function"}function Ve(a){return"~standard"in a}async function We(a,r){const l=await r["~standard"].validate(a);return l.issues?{errors:l.issues?.map(n=>({name:n.path?.map(i=>typeof i=="object"?i.key:i).join(".")||"",message:n.message}))||[],result:null}:{errors:null,result:l.value}}async function Re(a,r){const[l,n]=r.validate(a);return l?{errors:l.failures().map(b=>({message:b.message,name:b.path.join(".")})),result:null}:{errors:null,result:n}}function Me(a,r){if(Ve(r))return We(a,r);if(De(r))return Re(a,r);throw new Error("Form validation failed: Unsupported form schema")}function Te(a,r){return r?r.split(".").reduce((n,i)=>n?.[i],a):a}function Le(a,r,l){if(!r)return Object.assign(a,l);if(!a)return a;const n=r.split(".");let i=a;for(let f=0;f<n.length-1;f++){const u=n[f];(i[u]===void 0||i[u]===null)&&(f+1<n.length&&!Number.isNaN(Number(n[f+1]))?i[u]=[]:i[u]={}),i=i[u]}const b=n[n.length-1];return i[b]=l,a}class K extends Error{formId;errors;constructor(r,l){super("Form validation exception"),this.formId=r,this.errors=l,Object.setPrototypeOf(this,K.prototype)}}const Ue={base:""},Xe={__name:"UForm",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:null,required:!1},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},name:{type:null,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},nested:{type:null,required:!1},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(a,{expose:r,emit:l}){const n=a,i=l,b=se(),f=S(()=>M({extend:M(Ue),...b.ui?.form||{}})),u=n.id??le(),h=Oe(`form-${u}`),j=n.nested?.toString()===""||n.nested===!0,c=j&&T(re,void 0),P=j?T(ae,void 0):void 0,B=S(()=>P?.value?n.name?Te(P.value,n.name):P.value:n.state);E(re,h),E(ae,B);const k=N(new Map);ne(async()=>{c&&(await Ie(),c.emit({type:"attach",validate:$,formId:u,name:n.name,api:ee}))}),Fe(()=>{h.reset(),c&&c.emit({type:"detach",formId:u})}),ne(async()=>{h.on(async e=>{e.type==="attach"?k.value.set(e.formId,{validate:e.validate,name:e.name,api:e.api}):e.type==="detach"?k.value.delete(e.formId):n.validateOn?.includes(e.type)&&!q.value&&(e.type!=="input"?await $({name:e.name,silent:!0,nested:!1}):(e.eager||L.has(e.name))&&await $({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&L.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&H.add(e.name),(e.type==="change"||e.type==="input")&&D.add(e.name)})});const d=N([]);E(ie,d);const C=N({});E(oe,C);const D=U(new Set),H=U(new Set),L=U(new Set);function J(e){return e.map(t=>({...t,id:t?.name?C.value[t.name]?.id:void 0}))}const V=N(null);async function ce(){let e=n.validate?await n.validate(B.value)??[]:[];if(n.schema){const{errors:t,result:s}=await Me(B.value,n.schema);t?e=e.concat(t):V.value=s}return J(e)}async function $(e={silent:!1,nested:!1,transform:!1}){const t=e.name&&!Array.isArray(e.name)?[e.name]:e.name;let s=[],o=[];if(!t&&e.nested){const g=Array.from(k.value.values()).map(y=>de(y,e)),p=await Promise.all(g);o=p.filter(y=>y.error).flatMap(y=>y.error.errors.map(be=>fe(be,y.name))),s=p.filter(y=>y.output!==void 0)}const F=[...await ce(),...o];if(t?d.value=ve(F,t):d.value=F,d.value?.length){if(e.silent)return!1;throw new K(u,d.value)}return e.transform?(s.forEach(g=>{g.name?Le(V.value,g.name,g.output):Object.assign(V.value,g.output)}),V.value??B.value):B.value}const q=N(!1);E(Ne,R(q));async function Q(e){q.value=n.loadingAuto&&!0;const t=e;try{t.data=await $({nested:!0,transform:n.transform}),await n.onSubmit?.(t),D.clear()}catch(s){if(!(s instanceof K))throw s;const o={...t,errors:s.errors};i("error",o)}finally{q.value=!1}}const X=S(()=>n.disabled||q.value);E(je,S(()=>({disabled:X.value,validateOnInputDelay:n.validateOnInputDelay})));async function de(e,t){try{const s=await e.validate({...t,silent:!1});return{name:e.name,output:s}}catch(s){if(!(s instanceof K))throw s;return{name:e.name,error:s}}}function fe(e,t){return!t||!e.name?e:{...e,name:t+"."+e.name}}function me(e,t){const s=t+".",o=e?.name?.startsWith(s)?e.name.substring(s.length):e.name;return{...e,name:o}}function pe(e,t){return t?e.filter(s=>s?.name?.startsWith(t+".")).map(s=>me(s,t)):e}function Y(e){return e.api.getErrors().map(t=>e.name?{...t,name:e.name+"."+t.name}:t)}function Z(e,t){return!e||!t?!0:e instanceof RegExp?e.test(t):t===e||typeof e=="string"&&e.startsWith(t+".")}function ye(e,t){if(!e||e instanceof RegExp)return e;if(t!==e)return typeof e=="string"&&e.startsWith(t+".")?e.substring(t.length+1):e}function ve(e,t){const s=new Set(t),o=t.map(p=>C.value?.[p]?.pattern).filter(Boolean),m=p=>p.name?s.has(p.name)?!0:o.some(y=>y.test(p.name)):!1,F=d.value.filter(p=>!m(p)),g=e.filter(m);return[...F,...g]}function he(e,t){return e.filter(s=>t instanceof RegExp?!(s.name&&t.test(s.name)):!s.name||s.name!==t)}function _(e){return!e.name||!!C.value[e.name]}const ee={validate:$,errors:d,setErrors(e,t){const s=J(e.filter(_)),o=[];for(const m of k.value.values())if(Z(t,m.name)){const F=pe(e,m.name);m.api.setErrors(F,ye(t,m.name||"")),o.push(...Y(m))}if(t){const m=he(d.value,t);d.value=[...m,...s,...o]}else d.value=[...s,...o]},async submit(){await Q(new Event("submit"))},getErrors(e){return e?d.value.filter(t=>e instanceof RegExp?t.name&&e.test(t.name):t.name===e):d.value},clear(e){const t=e?d.value.filter(o=>_(o)&&(e instanceof RegExp?!(o.name&&e.test(o.name)):o.name!==e)):[],s=[];for(const o of k.value.values())Z(e,o.name)&&o.api.clear(),s.push(...Y(o));d.value=[...t,...s]},disabled:X,loading:q,dirty:S(()=>!!D.size),dirtyFields:R(D),blurredFields:R(L),touchedFields:R(H)};return r(ee),(e,t)=>(x(),ue(ke(w(c)?"div":"form"),{id:w(u),class:v(f.value({class:n.class})),onSubmit:Be(Q,["prevent"])},{default:G(()=>[I(e.$slots,"default",{errors:d.value,loading:q.value})]),_:3},40,["id","class"]))}};export{Xe as _,Qe as a};
