import{j as M,v as R,s as F,q as p,A as j,av as A,c as w,o as x,a as r,b as y,k as S,d as b,F as U,J as $,aB as E,aC as K,i as n,w as N,t as _,l as L,y as Y}from"#entry";import{s as q}from"./BzLCLO6P.js";import{b as J,c as W}from"./R0OndqsU.js";const z={class:"flex-1 w-full h-full flex flex-col bg-background"},G={class:"flex-grow flex items-center justify-center p-4"},H={class:"rounded-3xl p-10 w-full max-w-xl flex flex-col items-center text-center"},O={class:"relative mb-6 inline-block"},Q={class:"flex gap-3 mb-8"},X=["onUpdate:modelValue","disabled","onInput","onKeydown","onPaste"],Z={class:"flex gap-1 text-base mt-6"},ee=["disabled"],re=M({__name:"change-password-code",setup(te){const g=R(),C=F(),l=p(!1),c=p(!1),i=p(0),o=p(["","","","","",""]),h=p([]);let u=null;const v=e=>{h.value[e]&&h.value[e].focus()},k=(e,t)=>{const a=t.target,d=a.value;d.length>1?(o.value[e]=d.slice(0,1),a.value=o.value[e]):o.value[e]=d,d&&e<5&&v(e+1)},I=(e,t)=>{t.key==="Backspace"&&!o.value[e]&&e>0&&v(e-1)},P=e=>{e.preventDefault();const a=(e.clipboardData?.getData("text")||"").replace(/\D/g,"").slice(0,6).split("");a.forEach((d,m)=>{m<6&&(o.value[m]=d)}),v(Math.min(a.length,5))},D=(e=60)=>{i.value=e,u&&clearInterval(u),u=q(()=>{i.value-=1,i.value<=0&&(clearInterval(u),u=null)},1e3)},V=()=>c.value?"Sending...":i.value>0?`Wait ${i.value}s`:"Resend Code",T=async()=>{if(l.value)return;const e=o.value.join("");if(e.length!==6){g.add({title:"Invalid Code",description:"Please enter all 6 digits.",color:"error"});return}l.value=!0,c.value=!0;try{const t=await J(e);g.add({title:t?.messageTitle||"Code Verified!",description:t?.message||"You can now change your password.",color:"success"}),await new Promise(a=>setTimeout(a,1e3)),C.allowedChangePassword=!0,Y(`/change-password-new?code=${e}`)}catch(t){let a="An unexpected error occurred.";t?.data?.error?a=t.data.error:t?.message?a=t.message:t?.error&&(a=t.error),g.add({title:"Verification Failed",description:a,color:"error"}),o.value=["","","","","",""],v(0),l.value=!1,c.value=!1}},B=async()=>{if(c.value||i.value>0){i.value>0&&g.add({title:"Please wait",description:`Please wait ${Math.ceil(i.value/60)} minute(s) before resending.`,color:"error"});return}l.value=!0,c.value=!0;try{const e=await W();g.add({title:e?.messageTitle||"Code Resent!",description:e?.message||"A new code has been sent to your email.",color:"success"}),o.value=["","","","","",""],v(0),D(60)}catch(e){let t="Failed to resend code.";e?.data?.error&&(t=e.data.error),g.add({title:"Resend Failed",description:t,color:"error"}),l.value=!1,c.value=!1}};return j(()=>{v(0)}),A(()=>{u&&clearInterval(u)}),(e,t)=>{const a=S,d=L;return x(),w("div",z,[r("main",G,[r("div",H,[r("div",O,[y(a,{name:"heroicons:shield-check",class:"w-26 h-26 text-green-500"})]),t[1]||(t[1]=r("h2",{class:"text-4xl font-extrabold text-gray-900 dark:text-white mb-4"}," Enter security code ",-1)),t[2]||(t[2]=r("p",{class:"text-lg text-gray-600 dark:text-gray-400 mb-8"},[b(" Please check your email for a message with your code."),r("br"),b(" Your code is 6 digits long. ")],-1)),r("div",Q,[(x(!0),w(U,null,$(n(o),(m,f)=>E((x(),w("input",{key:f,ref_for:!0,ref:s=>{s&&(n(h)[f]=s)},"onUpdate:modelValue":s=>n(o)[f]=s,type:"text",inputmode:"numeric",maxlength:"1",class:"w-14 h-14 text-center text-2xl font-bold bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-xl border-none outline-none focus:ring-2 focus:ring-green-500 transition",disabled:n(l),onInput:s=>k(f,s),onKeydown:s=>I(f,s),onPaste:s=>f===0?P(s):null},null,40,X)),[[K,n(o)[f]]])),128))]),y(d,{onClick:T,class:"w-full h-12 rounded-xl cursor-pointer justify-center text-lg font-bold bg-green-600 hover:bg-green-700 text-white",disabled:n(l),loading:n(l)},{default:N(()=>[b(_(n(l)?"Verifying...":"Continue"),1)]),_:1},8,["disabled","loading"]),r("div",Z,[t[0]||(t[0]=r("p",{class:"text-gray-600 dark:text-gray-400"},"Didn't receive the code?",-1)),r("button",{class:"text-gray-900 dark:text-white font-bold underline hover:text-green-600 dark:hover:text-green-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:n(c)||n(i)>0,onClick:B},_(V()),9,ee)])])])])}}});export{re as default};
