import{_ as _e}from"./DuMeszsS.js";import{e as J,j as Se,f as Q,o as _,w as I,r as q,m as Ee,k as p,P as le,l as qe,n as ue,p as A,q as M,s as G,v as de,x as P,y as ce,z as me,A as Fe,B as F,C as Ae,a as v,D as w,c as N,E as K,b as g,d as V,t as T,F as Ie,G as ne,H as oe,I as ie,J as $e,K as R,L as je,M as W,N as ke,O as Be,Q as Ne,R as Oe,g as Pe,h as Ve,S as Le,T as Te,U as Ue,V as Ce}from"#entry";import{u as De,_ as ze}from"./C257s8ZL.js";var Ke=J({__name:"Label",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"label"}},setup(s){const a=s;return Se(),(l,r)=>(_(),Q(p(le),Ee(a,{onMousedown:r[0]||(r[0]=n=>{!n.defaultPrevented&&n.detail>1&&n.preventDefault()})}),{default:I(()=>[q(l.$slots,"default")]),_:3},16))}}),Re=Ke;const We={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between",label:"block font-medium text-default",container:"mt-1 relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}}},defaultVariants:{size:"md"}},Me=["id"],Ge=["id"],He=["id"],Je=["id"],Qe={__name:"UFormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[Boolean,String],required:!1},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(s){const a=s,l=qe(),r=ue(),n=A(()=>M({extend:M(We),...r.ui?.formField||{}})({size:a.size,required:a.required})),c=G(de,null),u=A(()=>a.error||c?.value?.find(f=>f.name===a.name||a.errorPattern&&f.name?.match(a.errorPattern))?.message),o=P(ce()),y=o.value,S=G(me,void 0);return Fe(o,()=>{S&&a.name&&(S.value[a.name]={id:o.value,pattern:a.errorPattern})},{immediate:!0}),F(Ie,o),F(Ae,A(()=>({error:u.value,name:a.name,size:a.size,eagerValidation:a.eagerValidation,validateOnInputDelay:a.validateOnInputDelay,errorPattern:a.errorPattern,hint:a.hint,description:a.description,help:a.help,ariaId:y}))),(f,$)=>(_(),Q(p(le),{as:s.as,class:w(n.value.root({class:[a.ui?.root,a.class]}))},{default:I(()=>[v("div",{class:w(n.value.wrapper({class:a.ui?.wrapper}))},[s.label||l.label?(_(),N("div",{key:0,class:w(n.value.labelWrapper({class:a.ui?.labelWrapper}))},[g(p(Re),{for:o.value,class:w(n.value.label({class:a.ui?.label}))},{default:I(()=>[q(f.$slots,"label",{label:s.label},()=>[V(T(s.label),1)])]),_:3},8,["for","class"]),s.hint||l.hint?(_(),N("span",{key:0,id:`${p(y)}-hint`,class:w(n.value.hint({class:a.ui?.hint}))},[q(f.$slots,"hint",{hint:s.hint},()=>[V(T(s.hint),1)])],10,Me)):K("",!0)],2)):K("",!0),s.description||l.description?(_(),N("p",{key:1,id:`${p(y)}-description`,class:w(n.value.description({class:a.ui?.description}))},[q(f.$slots,"description",{description:s.description},()=>[V(T(s.description),1)])],10,Ge)):K("",!0)],2),v("div",{class:w([(s.label||!!l.label||s.description||!!l.description)&&n.value.container({class:a.ui?.container})])},[q(f.$slots,"default",{error:u.value}),typeof u.value=="string"&&u.value||l.error?(_(),N("div",{key:0,id:`${p(y)}-error`,class:w(n.value.error({class:a.ui?.error}))},[q(f.$slots,"error",{error:u.value},()=>[V(T(u.value),1)])],10,He)):s.help||l.help?(_(),N("div",{key:1,id:`${p(y)}-help`,class:w(n.value.help({class:a.ui?.help}))},[q(f.$slots,"help",{help:s.help},()=>[V(T(s.help),1)])],10,Je)):K("",!0)],2)]),_:3},8,["as","class"]))}};function Xe(s){return"schema"in s&&typeof s.coercer=="function"&&typeof s.validator=="function"&&typeof s.refiner=="function"}function Ye(s){return"~standard"in s}async function Ze(s,a){const l=await a["~standard"].validate(s);return l.issues?{errors:l.issues?.map(r=>({name:r.path?.map(n=>typeof n=="object"?n.key:n).join(".")||"",message:r.message}))||[],result:null}:{errors:null,result:l.value}}async function et(s,a){const[l,r]=a.validate(s);return l?{errors:l.failures().map(c=>({message:c.message,name:c.path.join(".")})),result:null}:{errors:null,result:r}}function tt(s,a){if(Ye(a))return Ze(s,a);if(Xe(a))return et(s,a);throw new Error("Form validation failed: Unsupported form schema")}function st(s,a){return a?a.split(".").reduce((r,n)=>r?.[n],s):s}function at(s,a,l){if(!a)return Object.assign(s,l);if(!s)return s;const r=a.split(".");let n=s;for(let u=0;u<r.length-1;u++){const o=r[u];(n[o]===void 0||n[o]===null)&&(u+1<r.length&&!Number.isNaN(Number(r[u+1]))?n[o]=[]:n[o]={}),n=n[o]}const c=r[r.length-1];return n[c]=l,s}class U extends Error{formId;errors;constructor(a,l){super("Form validation exception"),this.formId=a,this.errors=l,Object.setPrototypeOf(this,U.prototype)}}const rt={base:""},nt={__name:"UForm",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:null,required:!1},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},name:{type:null,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},nested:{type:null,required:!1},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(s,{expose:a,emit:l}){const r=s,n=l,c=ue(),u=A(()=>M({extend:M(rt),...c.ui?.form||{}})),o=r.id??ce(),y=De(`form-${o}`),S=r.nested?.toString()===""||r.nested===!0,f=S&&G(ne,void 0),$=S?G(oe,void 0):void 0,j=A(()=>$?.value?r.name?st($.value,r.name):$.value:r.state);F(ne,y),F(oe,j);const k=P(new Map);ie(async()=>{f&&(await $e(),f.emit({type:"attach",validate:L,formId:o,name:r.name,api:re}))}),je(()=>{y.reset(),f&&f.emit({type:"detach",formId:o})}),ie(async()=>{y.on(async e=>{e.type==="attach"?k.value.set(e.formId,{validate:e.validate,name:e.name,api:e.api}):e.type==="detach"?k.value.delete(e.formId):r.validateOn?.includes(e.type)&&!B.value&&(e.type!=="input"?await L({name:e.name,silent:!0,nested:!1}):(e.eager||H.has(e.name))&&await L({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&H.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&X.add(e.name),(e.type==="change"||e.type==="input")&&D.add(e.name)})});const d=P([]);F(de,d);const C=P({});F(me,C);const D=W(new Set),X=W(new Set),H=W(new Set);function Y(e){return e.map(t=>({...t,id:t?.name?C.value[t.name]?.id:void 0}))}const z=P(null);async function fe(){let e=r.validate?await r.validate(j.value)??[]:[];if(r.schema){const{errors:t,result:i}=await tt(j.value,r.schema);t?e=e.concat(t):z.value=i}return Y(e)}async function L(e={silent:!1,nested:!1,transform:!1}){const t=e.name&&!Array.isArray(e.name)?[e.name]:e.name;let i=[],m=[];if(!t&&e.nested){const E=Array.from(k.value.values()).map(x=>pe(x,e)),b=await Promise.all(E);m=b.filter(x=>x.error).flatMap(x=>x.error.errors.map(we=>ve(we,x.name))),i=b.filter(x=>x.output!==void 0)}const O=[...await fe(),...m];if(t?d.value=be(O,t):d.value=O,d.value?.length){if(e.silent)return!1;throw new U(o,d.value)}return e.transform?(i.forEach(E=>{E.name?at(z.value,E.name,E.output):Object.assign(z.value,E.output)}),z.value??j.value):j.value}const B=P(!1);F(ke,R(B));async function Z(e){B.value=r.loadingAuto&&!0;const t=e;try{t.data=await L({nested:!0,transform:r.transform}),await r.onSubmit?.(t),D.clear()}catch(i){if(!(i instanceof U))throw i;const m={...t,errors:i.errors};n("error",m)}finally{B.value=!1}}const ee=A(()=>r.disabled||B.value);F(Be,A(()=>({disabled:ee.value,validateOnInputDelay:r.validateOnInputDelay})));async function pe(e,t){try{const i=await e.validate({...t,silent:!1});return{name:e.name,output:i}}catch(i){if(!(i instanceof U))throw i;return{name:e.name,error:i}}}function ve(e,t){return!t||!e.name?e:{...e,name:t+"."+e.name}}function ye(e,t){const i=t+".",m=e?.name?.startsWith(i)?e.name.substring(i.length):e.name;return{...e,name:m}}function he(e,t){return t?e.filter(i=>i?.name?.startsWith(t+".")).map(i=>ye(i,t)):e}function te(e){return e.api.getErrors().map(t=>e.name?{...t,name:e.name+"."+t.name}:t)}function se(e,t){return!e||!t?!0:e instanceof RegExp?e.test(t):t===e||typeof e=="string"&&e.startsWith(t+".")}function ge(e,t){if(!e||e instanceof RegExp)return e;if(t!==e)return typeof e=="string"&&e.startsWith(t+".")?e.substring(t.length+1):e}function be(e,t){const i=new Set(t),m=t.map(b=>C.value?.[b]?.pattern).filter(Boolean),h=b=>b.name?i.has(b.name)?!0:m.some(x=>x.test(b.name)):!1,O=d.value.filter(b=>!h(b)),E=e.filter(h);return[...O,...E]}function xe(e,t){return e.filter(i=>t instanceof RegExp?!(i.name&&t.test(i.name)):!i.name||i.name!==t)}function ae(e){return!e.name||!!C.value[e.name]}const re={validate:L,errors:d,setErrors(e,t){const i=Y(e.filter(ae)),m=[];for(const h of k.value.values())if(se(t,h.name)){const O=he(e,h.name);h.api.setErrors(O,ge(t,h.name||"")),m.push(...te(h))}if(t){const h=xe(d.value,t);d.value=[...h,...i,...m]}else d.value=[...i,...m]},async submit(){await Z(new Event("submit"))},getErrors(e){return e?d.value.filter(t=>e instanceof RegExp?t.name&&e.test(t.name):t.name===e):d.value},clear(e){const t=e?d.value.filter(m=>ae(m)&&(e instanceof RegExp?!(m.name&&e.test(m.name)):m.name!==e)):[],i=[];for(const m of k.value.values())se(e,m.name)&&m.api.clear(),i.push(...te(m));d.value=[...t,...i]},disabled:ee,loading:B,dirty:A(()=>!!D.size),dirtyFields:R(D),blurredFields:R(H),touchedFields:R(X)};return a(re),(e,t)=>(_(),Q(Oe(p(f)?"div":"form"),{id:p(o),class:w(u.value({class:r.class})),onSubmit:Ne(Z,["prevent"])},{default:I(()=>[q(e.$slots,"default",{errors:d.value,loading:B.value})]),_:3},40,["id","class"]))}};function ot(s,a){const l=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,r=/^.{8,}$/,n=/^\s*$/,c=[];return a==="login"&&(!s.emailAddress||n.test(s.emailAddress)?c.push({name:"emailAddress",message:"Email address is required."}):s.emailAddress&&!l.test(s.emailAddress)&&c.push({name:"emailAddress",message:"Wrong email address format."}),!s.password||n.test(s.password)?c.push({name:"password",message:"Password is required."}):s.password&&!r.test(s.password)&&c.push({name:"password",message:"Passwords should be at least 8 characters long."})),c}const it={class:"flex flex-col gap-10 box-border px-[10%] pb-[10%] max-w-2xl w-full"},lt={class:"mr-auto"},ut={class:"flex gap-3"},dt=J({__name:"AuthForm",props:{authType:{}},emits:["onSubmitLogin"],setup(s,{emit:a}){const l=s,r=a,n=W({emailAddress:"",password:"",username:"",confirmPassword:""}),c=async u=>{l.authType==="login"&&r("onSubmitLogin",u.data.emailAddress,u.data.password)};return(u,o)=>{const y=_e,S=Pe,f=ze,$=Qe,j=Ve,k=nt;return _(),N("div",it,[v("div",lt,[g(y)]),v("div",ut,[g(S,{name:"icons:logo",class:"w-12 h-12"}),o[3]||(o[3]=v("h1",{class:"text-5xl font-extrabold"},"Libris",-1))]),o[7]||(o[7]=v("div",{class:"flex flex-col gap-1"},[v("h2",{class:"text-3xl font-bold"},"Login"),v("h3",null,"Open the door to endless reading â€” your next book awaits.")],-1)),g(k,{validate:d=>("validateAuthForm"in u?u.validateAuthForm:p(ot))(d,l.authType),state:p(n),class:"space-y-4",onSubmit:o[2]||(o[2]=d=>c(d))},{default:I(()=>[g($,{label:"Email Address",name:"emailAddress"},{default:I(()=>[g(f,{modelValue:p(n).emailAddress,"onUpdate:modelValue":o[0]||(o[0]=d=>p(n).emailAddress=d),class:"w-90"},null,8,["modelValue"])]),_:1}),g($,{label:"Password",name:"password"},{default:I(()=>[g(f,{modelValue:p(n).password,"onUpdate:modelValue":o[1]||(o[1]=d=>p(n).password=d),type:"password",class:"w-90"},null,8,["modelValue"])]),_:1}),o[5]||(o[5]=v("p",{class:"text-sm text-violet-700 dark:text-violet-500 cursor-pointer"}," Forgot your password? ",-1)),g(j,{type:"submit",class:"w-90 h-9 cursor-pointer justify-center text-lg font-bold"},{default:I(()=>[...o[4]||(o[4]=[V("Login",-1)])]),_:1}),o[6]||(o[6]=v("div",{class:"flex gap-1"},[v("p",{class:"text-sm"},"Don't have an account?"),v("p",{class:"text-sm text-violet-700 dark:text-violet-500 cursor-pointer"},"Sign Up")],-1))]),_:1},8,["validate","state"])])}}}),ct=Object.assign(dt,{__name:"AuthForm"}),mt={class:"max-h-screen w-full flex overflow-hidden bg-background text-base"},ft={class:"flex-1 flex items-center justify-center"},pt={class:"flex-1"},gt=J({__name:"login",setup(s){const a=Le(),l=Te(),r=async(n,c)=>{try{const{messageTitle:u,message:o}=await l.login(n,c);a.add({title:u,description:o,color:"success"}),Ce("/dashboard")}catch(u){a.add({title:"Login failed.",description:u.data.error,color:"error"})}};return(n,c)=>{const u=ct,o=Ue;return _(),N("div",mt,[v("div",ft,[g(u,{"auth-type":"login",onOnSubmitLogin:c[0]||(c[0]=(y,S)=>r(y,S))})]),v("div",pt,[g(o,{src:"/images/authImage1.jpg",class:"w-full h-full object-cover",alt:"Auth image"})])])}}});export{gt as default};
