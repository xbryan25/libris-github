import{j as P,c as b,o as l,a as s,t as O,q as x,s as S,ay as j,f as R,C as M,A as U,h as N,w as r,i as a,bg as z,b as e,l as T,F as V,J as E,_ as D,d as J,x as W,az as G,k as H,n as v}from"#entry";import{u as K,_ as Q,a as X,b as Y}from"./Dg4lPkel.js";import{_ as Z}from"./B1FJlU1A.js";import{_ as ee}from"./CrUhTerV.js";import{_ as te}from"./BO2WUozZ.js";import{u as se}from"./Qdc9UZxI.js";import"./BdGgjiO2.js";import"./CxmxAOEW.js";import"./QkSgYxCE.js";import"./DNBF-Q6I.js";import"./BYnHXhte.js";import"./kRIii9yh.js";import"./C7gYzAMW.js";import"./B8ufzAAH.js";const oe={class:"cursor-pointer border-2 border-surface p-2 rounded-md hover:bg-surface-hover"},ne={class:"font-semibold text-sm"},ae={class:"text-xs w-full truncate"},re=P({__name:"RecentNotificationCard",props:{notificationDetails:{}},setup(g){const i=g;return(w,y)=>(l(),b("div",oe,[s("h2",ne,O(i.notificationDetails.header),1),s("p",ae,O(i.notificationDetails.message),1)]))}}),ie=Object.assign(re,{__name:"RecentNotificationCard"}),ce={class:"w-75 h-85 p-2 flex flex-col gap-2"},le={key:0,class:"flex-1 flex flex-col gap-2"},ue={key:1,class:"flex-1 flex justify-center items-center"},de=4,fe=P({__name:"NotificationsPopover",props:{isOpen:{type:Boolean}},emits:["update:isOpen"],setup(g,{emit:i}){const w=g,y=i,f=x(null),_=x(!1),h=x([]),p=x(!1),o=x(0),t=S(),{updateUnreadNotificationsCount:u}=j(t.userId),c=R({get:()=>w.isOpen,set:n=>{y("update:isOpen",n)}}),C=R(()=>{const n=o.value;return n>99?"99+":n.toString()}),k=async()=>{const n={rowsPerPage:de,pageNumber:1,readStatus:"show only unread",order:"show newest first"};h.value=await X(n)},$=async()=>{const{totalCount:n}=await Y("show only unread");o.value=n};return M(()=>u.value,async n=>{n!=null&&(await k(),o.value=n)}),U(async()=>{p.value=!0,await k(),await $(),p.value=!1}),(n,d)=>{const B=T,A=z,I=ie,L=D,F=Q,q=Z;return l(),N(q,{open:a(c),"onUpdate:open":d[1]||(d[1]=m=>W(c)?c.value=m:null),arrow:""},{content:r(()=>[s("div",ce,[d[4]||(d[4]=s("h1",{class:"font-bold text-xl"},"Unread Notifications",-1)),a(h).length>0?(l(),b("div",le,[(l(!0),b(V,null,E(a(h),m=>(l(),N(I,{key:m.notificationId,"notification-details":m,onClick:async()=>{f.value=m,_.value=!0,await a(K)(m.notificationId)}},null,8,["notification-details","onClick"]))),128))])):(l(),b("div",ue,[...d[2]||(d[2]=[s("p",{class:"text-sm"},"Notifications will show up here...",-1)])])),e(L,{to:"/notifications",class:"w-full"},{default:r(()=>[e(B,{color:"neutral",class:"justify-center cursor-pointer w-full"},{default:r(()=>[...d[3]||(d[3]=[J("See more...",-1)])]),_:1})]),_:1})]),e(F,{"is-open-notification-modal":a(_),header:a(f)?.header,message:a(f)?.message,"created-at":a(f)?.createdAt,"onUpdate:openNotificationModal":d[0]||(d[0]=m=>_.value=m)},null,8,["is-open-notification-modal","header","message","created-at"])]),default:r(()=>[s("div",null,[a(o)>0?(l(),N(A,{key:0,text:a(C),size:"3xl",ui:{base:"py-2 px-1"}},{default:r(()=>[e(B,{icon:"mdi:bell-outline",class:"flex items-center rounded-md p-2 bg-surface hover:bg-surface-hover hover:text-accent text-base cursor-pointer transition-colors"})]),_:1},8,["text"])):(l(),N(B,{key:1,icon:"mdi:bell-outline",class:"flex items-center rounded-md p-2 bg-surface hover:bg-surface-hover hover:text-accent text-base cursor-pointer transition-colors"}))])]),_:1},8,["open"])}}}),pe=Object.assign(fe,{__name:"NotificationsPopover"}),me={class:"min-h-screen w-full flex flex-col bg-background text-base"},xe={class:"w-full border-b border-base bg-surface"},_e={class:"w-full flex items-center justify-between px-6 py-4"},he={class:"flex items-center gap-2 ml-8"},be={class:"flex items-center gap-1 mr-8"},ve={key:0,class:"text-xl font-semibold text-accent"},ge={key:1,class:"text-xl font-semibold text-accent"},we={class:"flex-1 flex justify-center items-center bg-background"},We=P({__name:"default",setup(g){const i=G(),w=S(),{paymentSuccess:y}=j(w.userId),f=x(0),_=x(!0),h=x(!1),p=o=>i.path===o?!0:o==="/rentals"?i.path.startsWith("/rentals"):o==="/purchases"?i.path.startsWith("/purchases"):!!(i.path.startsWith("/books/")&&i.query.from&&o==="/browse"&&i.query.from==="browse");return M(()=>y.value,o=>{o!=null&&(f.value=f.value+o)}),U(async()=>{_.value=!0;const o=await se();f.value=o.currentWalletBalance??0,_.value=!1}),(o,t)=>{const u=H,c=D,C=pe,k=ee,$=te;return l(),b("div",me,[s("nav",xe,[s("div",_e,[s("div",he,[e(u,{name:"icons:logo",class:"w-9 h-9 text-accent"}),t[1]||(t[1]=s("h1",{class:"text-2xl font-semibold"},"Libris",-1))]),s("div",be,[e(c,{to:"/dashboard",class:v(["flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",p("/dashboard")?"bg-accent text-white":"hover:bg-surface-hover hover:text-accent text-base"])},{default:r(()=>[e(u,{name:"ri:dashboard-line",class:"w-5 h-5 flex-shrink-0"}),t[2]||(t[2]=s("span",null,"Dashboard",-1))]),_:1},8,["class"]),e(c,{to:"/browse",class:v(["flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",p("/browse")?"bg-accent text-white":"hover:bg-surface-hover hover:text-accent text-base"])},{default:r(()=>[e(u,{name:"ph:magnifying-glass-bold",class:"w-5 h-5"}),t[3]||(t[3]=s("span",null,"Browse",-1))]),_:1},8,["class"]),e(c,{to:"/library",class:v(["flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",p("/library")?"bg-accent text-white":"hover:bg-surface-hover hover:text-accent text-base"])},{default:r(()=>[e(u,{name:"lucide:book-open",class:"w-5 h-5 flex-shrink-0"}),t[4]||(t[4]=s("span",null,"My Library",-1))]),_:1},8,["class"]),e(c,{to:"/rentals",class:v(["flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",p("/rentals")?"bg-accent text-white":"hover:bg-surface-hover hover:text-accent text-base"])},{default:r(()=>[e(u,{name:"ci-calendar",class:"w-5 h-5 flex-shrink-0"}),t[5]||(t[5]=s("span",null,"Rentals",-1))]),_:1},8,["class"]),e(c,{to:"/purchases",class:v(["flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",p("/purchases")?"bg-accent text-white":"hover:bg-surface-hover hover:text-accent text-base"])},{default:r(()=>[e(u,{name:"material-symbols:shopping-cart-outline-rounded",class:"w-5 h-5 flex-shrink-0"}),t[6]||(t[6]=s("span",null,"Purchases",-1))]),_:1},8,["class"]),e(c,{to:"/users/me",class:v(["flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",p("/users/me")?"bg-accent text-white":"hover:bg-surface-hover hover:text-accent text-base"])},{default:r(()=>[e(u,{name:"lucide:circle-user",class:"w-5 h-5 flex-shrink-0"}),t[7]||(t[7]=s("span",null,"Profile",-1))]),_:1},8,["class"]),e(c,{class:"flex items-center rounded-md px-3 py-2 gap-1.5 hover:bg-surface-hover hover:text-accent text-base",to:"/buy-readits"},{default:r(()=>[e(u,{name:"fluent:book-coins-20-regular",class:"w-6 h-6 text-accent"}),a(_)?(l(),b("span",ve,"-")):(l(),b("span",ge,O(a(f)),1))]),_:1}),e(C,{"is-open":a(h),"onUpdate:isOpen":t[0]||(t[0]=n=>W(h)?h.value=n:null)},null,8,["is-open"]),e(k,{class:"hover:text-accent hover:bg-surface-hover transition-colors"})])])]),s("main",we,[e($)])])}}});export{We as default};
