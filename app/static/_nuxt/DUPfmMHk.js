import{j as P,az as T,aA as j,v as S,s as U,q as v,y as _,A as N,av as $,c as y,o as E,a as t,b as h,k as K,d as b,F as q,J as W,aB as z,aC as J,i as l,w as G,t as V,l as H,aD as O}from"#entry";import{_ as Q}from"./CQQG8Akn.js";import{s as X}from"./BzLCLO6P.js";import{a as Z,b as ee}from"./Bf-nPiyi.js";const oe={class:"w-full min-h-screen flex flex-col bg-background text-base"},te={class:"w-full p-6 flex justify-between items-center"},se={class:"flex gap-3 items-center"},ae={class:"w-full px-6 mb-4"},ne={class:"flex-grow flex items-center justify-center p-4"},re={class:"rounded-3xl p-10 w-full max-w-xl flex flex-col items-center text-center"},le={class:"relative mb-6 inline-block"},ie={class:"absolute -top-2 -right-2 bg-white dark:bg-neutral-900 rounded-full border-4 border-white dark:border-neutral-900 flex items-center justify-center"},ce={class:"flex gap-3 mb-8"},de=["onUpdate:modelValue","disabled","onInput","onKeydown","onPaste"],ue={class:"flex gap-1 text-base mt-6"},ge=["disabled"],xe=P({__name:"verify-email",setup(fe){const R=T(),k=j(),g=S(),I=U(),c=v(!1),f=v(!1),n=v(0),m=v(R.query.userId||""),a=v(["","","","","",""]),w=v([]);let d=null;m.value||(console.log("[VERIFY-EMAIL] No userId found, redirecting to signup"),_("/signup")),console.log("[VERIFY-EMAIL] Page loaded with userId:",m.value);const p=e=>{w.value[e]&&w.value[e].focus()},C=(e,o)=>{const s=o.target,i=s.value;i.length>1?(a.value[e]=i.slice(0,1),s.value=a.value[e]):a.value[e]=i,i&&e<5&&p(e+1)},M=(e,o)=>{o.key==="Backspace"&&!a.value[e]&&e>0&&p(e-1)},A=e=>{e.preventDefault();const s=(e.clipboardData?.getData("text")||"").replace(/\D/g,"").slice(0,6).split("");s.forEach((i,x)=>{x<6&&(a.value[x]=i)}),p(Math.min(s.length,5))},L=(e=60)=>{console.log("[VERIFY-EMAIL] Starting cooldown for",e,"seconds"),n.value=e,d&&clearInterval(d),d=X(()=>{n.value-=1,n.value<=0&&(console.log("[VERIFY-EMAIL] Cooldown completed"),clearInterval(d),d=null)},1e3)},F=()=>f.value?"Sending...":n.value>0?`Wait ${n.value}s`:"Resend Code",Y=async()=>{if(c.value)return;const e=a.value.join("");if(e.length!==6){g.add({title:"Invalid Code",description:"Please enter all 6 digits.",color:"error"});return}c.value=!0;try{console.log("[VERIFY-EMAIL] Calling useVerifyEmailCode with userId:",m.value,"code:",e);const o=await Z(m.value,e);console.log("[VERIFY-EMAIL] Verify response:",o),g.add({title:o?.messageTitle||"Email Verified!",description:o?.message||"Your email has been successfully verified.",color:"success"}),_("/dashboard")}catch(o){console.error("[VERIFY-EMAIL] Verification error:",o);let s="An unexpected error occurred.";o?.data?.error?s=o.data.error:o?.message?s=o.message:o?.error&&(s=o.error),g.add({title:"Verification failed.",description:s,color:"error"}),a.value=["","","","","",""],p(0),c.value=!1}},D=async()=>{if(console.log("[VERIFY-EMAIL] Resend button clicked"),console.log("[VERIFY-EMAIL] isResending:",f.value),console.log("[VERIFY-EMAIL] resendCooldown:",n.value),f.value||n.value>0){if(console.log("[VERIFY-EMAIL] Resend blocked - already in progress or on cooldown"),n.value>0){const e=Math.ceil(n.value/60),o=`Please wait for ${e} minute${e>1?"s":""} before resending the code again, thank you.`;console.log("[VERIFY-EMAIL] Showing cooldown message:",o),g.add({title:"Please wait",description:o,color:"error"})}return}f.value=!0,console.log("[VERIFY-EMAIL] Starting resend process for userId:",m.value);try{console.log("[VERIFY-EMAIL] Calling useResendVerificationCode...");const e=await ee(m.value);console.log("[VERIFY-EMAIL] Resend response:",e),g.add({title:e?.messageTitle||"Code Resent!",description:e?.message||"A new verification code has been sent to your email.",color:"success"}),a.value=["","","","","",""],p(0),L(60)}catch(e){let o="Failed to resend code.";e?.data?.error?o=e.data.error:e?.message?o=e.message:e?.error&&(o=e.error),g.add({title:"Resend failed.",description:o,color:"error"})}finally{f.value=!1,console.log("[VERIFY-EMAIL] Resend process completed")}},B=async()=>{await O(),I.username=null,I.userId=null,I.isAuthenticated=!1,I.isEmailVerified=!1,k.push("/login")};return N(()=>{console.log("[VERIFY-EMAIL] Component mounted"),p(0)}),$(()=>{console.log("[VERIFY-EMAIL] Component unmounted"),d&&clearInterval(d)}),(e,o)=>{const s=K,i=Q,x=H;return E(),y("div",oe,[t("header",te,[t("div",se,[h(s,{name:"icons:logo",class:"w-12 h-12"}),o[0]||(o[0]=t("h1",{class:"text-4xl font-bold text-gray-900 dark:text-white"},"Libris",-1))]),h(i)]),t("div",ae,[t("button",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white flex items-center gap-2 transition-colors cursor-pointer",onClick:B},[h(s,{name:"heroicons:arrow-left",class:"w-5 h-5"}),o[1]||(o[1]=b(" Back to login ",-1))])]),t("main",ne,[t("div",re,[t("div",le,[h(s,{name:"heroicons:envelope",class:"w-26 h-26 text-gray-900 dark:text-white"}),t("div",ie,[h(s,{name:"heroicons:check-circle-solid",class:"w-10 h-10 text-green-500"})])]),o[3]||(o[3]=t("h2",{class:"text-4xl font-extrabold text-gray-900 dark:text-white mb-4"},"Check your inbox",-1)),o[4]||(o[4]=t("p",{class:"text-lg text-gray-600 dark:text-gray-400 mb-8"},[b(" We've sent a 6-digit code to your email."),t("br"),b(" Please enter it below to continue. ")],-1)),t("div",ce,[(E(!0),y(q,null,W(l(a),(me,u)=>z((E(),y("input",{key:u,ref_for:!0,ref:r=>{r&&(l(w)[u]=r)},"onUpdate:modelValue":r=>l(a)[u]=r,type:"text",inputmode:"numeric",maxlength:"1",class:"w-14 h-14 text-center text-2xl font-bold bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-xl border-none outline-none focus:ring-2 focus:ring-green-500 transition",disabled:l(c),onInput:r=>C(u,r),onKeydown:r=>M(u,r),onPaste:r=>u===0?A(r):null},null,40,de)),[[J,l(a)[u]]])),128))]),h(x,{class:"w-full h-12 rounded-xl cursor-pointer justify-center text-lg font-bold bg-green-600 hover:bg-green-700 text-white",disabled:l(c),loading:l(c),onClick:Y},{default:G(()=>[b(V(l(c)?"Verifying...":"Verify"),1)]),_:1},8,["disabled","loading"]),t("div",ue,[o[2]||(o[2]=t("p",{class:"text-gray-600 dark:text-gray-400"},"Didn't Receive it?",-1)),t("button",{class:"text-gray-900 dark:text-white font-bold underline hover:text-green-600 dark:hover:text-green-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:l(f)||l(n)>0,onClick:D},V(F()),9,ge)])])])])}}});export{xe as default};
